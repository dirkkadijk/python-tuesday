<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Python Tuesday: Session 2</title>
<meta name="author" content="Gábor Nyers" />
<style type="text/css">

/*
 * CSS
 */

html{
  background: #ffffff;
}

@media (max-width: 400px) {
  html {
    /* background: #ffcccc;  */
    font-size: 10px;
  }
}
@media (min-width: 401px) and (max-width: 800px) {
  html {
    /* background: #ccffcc; */
    font-size: 14px;
  }
}
@media (min-width: 801px) {
  html {
    /* background: #ccccff; */
    font-size: 20px;
    max-width: 1024px;
    margin: auto;
  }
}

.content {
  background: #c3c3c3;
}

h1, h2, h3 {
  border-bottom: 1pt #00ff00;
}

h1 {
  font-size: 1.4rem;
}

.topic-title {
  font-size: 1.4rem;
}


p {
  margin: 0.5em;
}

a {
  border: none;
}

dl {
  padding: 0.2em;
}
dt {
  float: left;
  clear: left;
  max-width: 200px;
  text-align: right;
  font-weight: bold;
  background: #f0f0f0;
  color: #222222;
  padding: 0 5px 0 5px;
}
dt::after {
  content: ": ";
}
dd {
  margin: 0 0 0 120px;
  padding: 0 0 0.5em 0;
  padding: 0 5px 0 5px;
}

dd p {
  margin: 0 0 0 0;
}

/* BEGIN */
pre, .literal {
  margin: 0.5em;
  background: #f0f0f0;
  font: 0.92rem Inconsolata, monospace;
  color: #222222;
  text-shadow: 0 0 5px #C8C8C8;
  white-space: pre-wrap;
  word-wrap: break-word;
}
::selection {
  background: #0080FF;
  text-shadow: none;
}
.ln, .prompt {
  -webkit-user-select: none;  /* Chrome all / Safari all */
  -moz-user-select: none;     /* Firefox all */
  -ms-user-select: none;      /* IE 10+ */
}
/*  END */


/*
vim: filetype=css textwidth=78 foldmethod=syntax foldcolumn=3 wrap
vim: linebreak ruler spell spelllang=en showbreak=… shiftwidth=2
vim: softtabstop=2 tabstop=2
*/


</style>
</head>
<body>
<div class="document" id="python-tuesday-session-2">
<h1 class="title">Python Tuesday: Session 2</h1>

<p class="subtitle" id="working-with-text-files-and-file-formats">Working with text files and file formats</p>
<dl class="docinfo simple">
<dt class="date">Date</dt>
<dd class="date">2019-08-27</dd>
<dt class="author">Author</dt>
<dd class="author"><p>Gábor Nyers</p></dd>
<dt class="tags">tags</dt>
<dd class="tags"><p>python</p>
</dd>
<dt class="category">category</dt>
<dd class="category"><p>python_workshop</p>
</dd>
<dt class="summary">summary</dt>
<dd class="summary"><p>A demonstration of reading and writing information to files in
different formats</p>
</dd>
<dt class="licence">licence</dt>
<dd class="licence"><p>CC BY-NC 4.0 <a class="reference external" href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</a></p>
</dd>
</dl>
<p><strong>Agenda</strong></p>
<div class="contents local topic" id="contents">
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#the-fundametals-writing-to-and-reading-from-files" id="id25"><span class="sectnum">1.</span> The fundametals: writing to and reading from files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#first-open-the-file" id="id26"><span class="sectnum">1.1.</span> First: Open the file</a></p></li>
<li><p><a class="reference internal" href="#be-careful-when-opening-a-file-for-writing" id="id27"><span class="sectnum">1.2.</span> Be careful when opening a file for writing!</a></p></li>
<li><p><a class="reference internal" href="#create-a-new-file-with-a-list-of-names" id="id28"><span class="sectnum">1.3.</span> Create a new file with a list of names</a></p></li>
<li><p><a class="reference internal" href="#read-the-file-with-the-names" id="id29"><span class="sectnum">1.4.</span> Read the file with the names</a></p></li>
<li><p><a class="reference internal" href="#a-word-about-unicode-and-encoding" id="id30"><span class="sectnum">1.5.</span> A word about Unicode and encoding</a></p></li>
<li><p><a class="reference internal" href="#summary" id="id31"><span class="sectnum">1.6.</span> Summary</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-csv-files" id="id32"><span class="sectnum">2.</span> Working with CSV files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#create-a-csv-file" id="id33"><span class="sectnum">2.1.</span> Create a CSV file</a></p></li>
<li><p><a class="reference internal" href="#read-data-from-a-csv-files" id="id34"><span class="sectnum">2.2.</span> Read data from a CSV files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-ini-files" id="id35"><span class="sectnum">3.</span> Working with INI files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#writing-data-to-ini-file" id="id36"><span class="sectnum">3.1.</span> Writing data to INI file</a></p></li>
<li><p><a class="reference internal" href="#reading-data-from-ini-files" id="id37"><span class="sectnum">3.2.</span> Reading data from INI files</a></p></li>
<li><p><a class="reference internal" href="#writing-configuration-data-to-ini-files" id="id38"><span class="sectnum">3.3.</span> Writing configuration data to INI files</a></p></li>
<li><p><a class="reference internal" href="#more-advanced-use-case-merging-of-multiple-configuration-files" id="id39"><span class="sectnum">3.4.</span> More advanced use-case: Merging of multiple configuration files</a></p></li>
<li><p><a class="reference internal" href="#more-advanced-use-case-interpolation-of-configuration-files" id="id40"><span class="sectnum">3.5.</span> More advanced use-case: Interpolation of configuration files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-json-files" id="id41"><span class="sectnum">4.</span> Working with JSON files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#json-support-in-python" id="id42"><span class="sectnum">4.1.</span> JSON support in Python</a></p></li>
<li><p><a class="reference internal" href="#writing-data-to-json-file" id="id43"><span class="sectnum">4.2.</span> Writing data to JSON file</a></p></li>
<li><p><a class="reference internal" href="#reading-data-from-json-files" id="id44"><span class="sectnum">4.3.</span> Reading data from JSON files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-yaml-files" id="id45"><span class="sectnum">5.</span> Working with YAML files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#yaml-support-in-python" id="id46"><span class="sectnum">5.1.</span> YAML support in Python</a></p></li>
<li><p><a class="reference internal" href="#writing-data-to-a-yaml-file" id="id47"><span class="sectnum">5.2.</span> Writing data to a YAML file</a></p></li>
<li><p><a class="reference internal" href="#more-advanced-yaml-use-case" id="id48"><span class="sectnum">5.3.</span> More advanced YAML use-case</a></p></li>
<li><p><a class="reference internal" href="#reading-data-from-a-yaml-files" id="id49"><span class="sectnum">5.4.</span> Reading data from a YAML files</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-xml-files" id="id50"><span class="sectnum">6.</span> Working with XML files</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#xml-support-in-python" id="id51"><span class="sectnum">6.1.</span> XML support in Python</a></p></li>
<li><p><a class="reference internal" href="#writing-xml-data" id="id52"><span class="sectnum">6.2.</span> Writing XML data</a></p></li>
<li><p><a class="reference internal" href="#reading-data-from-an-xml-file" id="id53"><span class="sectnum">6.3.</span> Reading data from an XML file</a></p></li>
<li><p><a class="reference internal" href="#processing-xml-data-in-python" id="id54"><span class="sectnum">6.4.</span> Processing XML data in Python</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id55"><span class="sectnum">7.</span> References</a></p></li>
</ul>
</div>
<p><strong>Prep</strong></p>
<ul>
<li><p>Get Material:
URL: <a class="reference external" href="https://github.com/gnyers/python-tuesday/session2">https://github.com/gnyers/python-tuesday/session2</a></p>
<pre class="code shell literal-block"><code>git clone git&#64;github.com:gnyers/python-tuesday.git</code></pre>
</li>
</ul>
<div class="section" id="the-fundametals-writing-to-and-reading-from-files">
<h1><a class="toc-backref" href="#id25"><span class="sectnum">1.</span> The fundametals: writing to and reading from files</a></h1>
<div class="section" id="first-open-the-file">
<h2><a class="toc-backref" href="#id26"><span class="sectnum">1.1.</span> First: Open the file</a></h2>
<p>Before being able to access any file Python needs to open it.</p>
<ol class="arabic">
<li><p>The absolute minimum:</p>
<p>(Example as executed in an interactive Python session or Python REPL)</p>
<pre class="code pycon literal-block"><code><span class="comment single"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="comment single"># open the file 'names.txt' for reading, assume a text file</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">)</span>
<span class="generic output">&gt;&gt;&gt;</span></code></pre>
<p>What this means:</p>
<ul class="simple">
<li><p><span class="docutils literal">fh</span>: will be the variable pointing to a new <em>file handler</em> object which
is the result of the <span class="docutils literal">open()</span> function</p></li>
<li><p><span class="docutils literal">open()</span>: function will create a new file handler object to the
<span class="docutils literal">names.txt</span> file</p></li>
<li><p>(allow read-only access to the file, because of missing second optional
<em>mode</em> argument)</p></li>
</ul>
</li>
<li><p>Open a file for writing only, for example to write some data to a new file:</p>
<pre class="code pycon literal-block"><code><span class="comment single"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="comment single"># open the file 'names.txt' for writing</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span>
<span class="generic output">&gt;&gt;&gt;</span></code></pre>
<p>The above instruction will perform the same as above, except for the
following:</p>
<ul>
<li><p><span class="docutils literal">&quot;wt&quot;</span>: an optional argument for the <span class="docutils literal">open()</span> function called the
<em>mode</em> string. This is a series of letter codes each with its specific
meaning as to how Python should request access to the file.</p>
<blockquote>
<ul class="simple">
<li><p><span class="docutils literal">&quot;w&quot;</span> request write-only access, create the file or truncate its
content, if it already exists</p></li>
<li><p><span class="docutils literal">&quot;t&quot;</span> interpret the file's content as Unicode text</p></li>
</ul>
</blockquote>
<p>See also: <a class="citation-reference" href="#pydoc-open" id="id1">[pydoc_open]</a>) for other letters and their meaning</p>
</li>
</ul>
</li>
<li><p>The <em>mode</em> string governs <strong>how</strong> the file is accessed:</p>
<p>Depending on the use-case we may want to access a file in many different
ways:</p>
<ol class="arabic simple">
<li><p>Load a configuration file: read-only, read once, content as text</p></li>
<li><p>Export a CSV file: write-only, write once, content as text</p></li>
<li><p>Read a picture from a PNG file: read-only, read once, binary content</p></li>
<li><p>Append a new record to a log file: write-only, append to the end of
a file (without overwriting the rest!), content as text</p></li>
<li><p>Modify 3 records in a big database file: read and write multiple times,
seek to a different positions within the file, binary content</p></li>
</ol>
</li>
</ol>
</div>
<div class="section" id="be-careful-when-opening-a-file-for-writing">
<h2><a class="toc-backref" href="#id27"><span class="sectnum">1.2.</span> Be careful when opening a file for writing!</a></h2>
<ol class="arabic">
<li><p>The dangers of the <span class="docutils literal">&quot;w&quot;</span> or <span class="docutils literal">&quot;w+&quot;</span> mode:</p>
<p>The letter codes <span class="docutils literal">&quot;w&quot;</span> and <span class="docutils literal">&quot;w+&quot;</span> in the <span class="docutils literal">open()</span> functions <em>mode</em>
string will both instruct Python to truncate an existing file. That is: all
existing content will be lost and may be only be recovered from an existing
backup.</p>
</li>
<li><p>Depending on your use case it may be safer to use the <span class="docutils literal">&quot;x&quot;</span> (or its
variant <span class="docutils literal">&quot;x+&quot;</span>) letter code instead. In this case, if the given file
exists, Python will throw an exception:</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">,</span> <span class="literal string single">'xt'</span><span class="punctuation">)</span>
<span class="ln">2 </span><span class="generic traceback">Traceback (most recent call last):
</span><span class="ln">3 </span><span class="generic traceback"></span>  File <span class="name builtin">&quot;&lt;stdin&gt;&quot;</span>, line <span class="literal number">1</span>, in <span class="name">&lt;module&gt;</span>
<span class="ln">4 </span><span class="generic error">FileExistsError</span>: <span class="name">[Errno 17] File exists: 'names.txt'</span>
<span class="ln">5 </span><span class="generic output">&gt;&gt;&gt;</span></code></pre>
<p>This <em>mode</em> is the only safe way to handle files</p>
</li>
</ol>
</div>
<div class="section" id="create-a-new-file-with-a-list-of-names">
<h2><a class="toc-backref" href="#id28"><span class="sectnum">1.3.</span> Create a new file with a list of names</a></h2>
<p>Suppose we have the following list of names and want to write them to a file
one name per line:</p>
<blockquote>
<p>Hayley Peter Chris Stan Brian Lois Marge Stewie Francine Meg</p>
</blockquote>
<pre class="code python literal-block" id="write-names-as-txt-py"><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln">2 </span><span class="name">names</span> <span class="operator">=</span> <span class="literal string single">'Hayley Peter Barney Stan Brian Lois Marge Stewie Francine Wilma'</span>
<span class="ln">3 </span>
<span class="ln">4 </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span>        <span class="comment single"># create empty file with name &quot;names.txt&quot;</span>
<span class="ln">5 </span><span class="name">names_l</span> <span class="operator">=</span> <span class="name">names</span><span class="operator">.</span><span class="name">split</span><span class="punctuation">()</span>             <span class="comment single"># split long ``str`` into a ``list``</span>
<span class="ln">6 </span><span class="keyword">for</span> <span class="name">name</span> <span class="operator word">in</span> <span class="name">names_l</span><span class="punctuation">:</span>                <span class="comment single"># loop through the list of names</span>
<span class="ln">7 </span>    <span class="name">fh</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">name</span> <span class="operator">+</span> <span class="literal string single">'</span><span class="literal string escape">\n</span><span class="literal string single">'</span><span class="punctuation">)</span>           <span class="comment single"># write current name + '\n' (new line)</span>
<span class="ln">8 </span><span class="name">fh</span><span class="operator">.</span><span class="name">close</span><span class="punctuation">()</span>                          <span class="comment single"># close file</span></code></pre>
<p>So, what has happened here:</p>
<ul>
<li><p><strong>line 1</strong>: special &quot;<a class="reference external" href="https://en.wikipedia.org/wiki/Shebang_(Unix)">Shebang</a>&quot; line, instructing the OS what interpreter to
execute this file with</p></li>
<li><p><strong>line 2</strong>: create a new <span class="docutils literal">str</span> object containing the names and bind the
<span class="docutils literal">names</span> variable to it</p></li>
<li><p><strong>line 4</strong>: (re-)create new empty file with the name &quot;names.txt&quot;
(Remember: an existing file's data will be deleted!)</p></li>
<li><p><strong>line 5</strong>: split-up the long <span class="docutils literal">str</span> object into multiple shorter <span class="docutils literal">str</span>
and gather them into a new <span class="docutils literal">list</span> object.
Because the <span class="docutils literal">.split()</span> method didn't received an argument, by default the
splitting will occur at the any of the following characters: ' ' (space),
't' (tab) and 'n' (new line)</p></li>
<li><p><strong>line 6</strong>: loop through the elements of the <span class="docutils literal">names_l</span> list object one
element  at a time. In each iteration the current element is bound to
the <span class="docutils literal">name</span> variable</p></li>
<li><p><strong>line 7</strong>: in each iteration write a <span class="docutils literal">str</span> containing the current name
and a <span class="docutils literal">&quot;\n&quot;</span> (new line) character to the file represented by the <span class="docutils literal">fh</span>
<em>file handler</em> object; in our case the <span class="docutils literal">names.txt</span> file.</p>
<p>This line will be executed for each element of the <span class="docutils literal">names_l</span> list, i.e.:
10 times.</p>
</li>
<li><p><strong>line 8</strong>: close the file</p></li>
</ul>
</div>
<div class="section" id="read-the-file-with-the-names">
<h2><a class="toc-backref" href="#id29"><span class="sectnum">1.4.</span> Read the file with the names</a></h2>
<p>Now that we have created the <span class="docutils literal">names.txt</span> file let's read the data. We have
more than one way to do this:</p>
<ol class="arabic">
<li><p>The simplest way to read the content of the file is to read the whole
content into memory, such as:</p>
<pre class="code pycon literal-block"><code><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">)</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="name">content</span> <span class="operator">=</span> <span class="name">fh</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">()</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="name builtin">type</span><span class="punctuation">(</span><span class="name">content</span><span class="punctuation">)</span>
<span class="generic output">&lt;class 'str'&gt;
</span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">content</span>
<span class="generic output">'Hayley\nPeter\nBarney\nStan\nBrian\nLois\nMarge\nStewie\nFrancine\nWilma\n'</span></code></pre>
<p>The file's content is now in a <span class="docutils literal">str</span> object, which when printed produces
to following output:</p>
<pre class="code pycon literal-block"><code><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">content</span><span class="punctuation">)</span>
<span class="generic output">Hayley
Peter
Barney
Stan
Brian
Lois
Marge
Stewie
Francine
Wilma
</span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span><span class="operator">.</span><span class="name">close</span><span class="punctuation">()</span></code></pre>
</li>
<li><p>More often than not we want to read text files line-by-line:</p>
<pre class="code pycon literal-block"><code><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">)</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">line</span> <span class="operator word">in</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="generic prompt">... </span>    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">line</span><span class="punctuation">)</span>              <span class="comment single"># doctest: +ELLIPSIS</span>
<span class="generic output">Hayley

Peter

Barney

Stan</span></code></pre>
<p>Please note the double spaced output! This is the consequence of the
default behaviors. On the one hand when reading a line, the <em>file handler</em>
leaves the <span class="docutils literal">&quot;\n&quot;</span> (new line) character intact at the end of the line.
Verify this by typing the <span class="docutils literal">line</span> variable, which still contains the
last line:</p>
<pre class="code pycon literal-block"><code><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">line</span>
<span class="generic output">'Wilma\n'
</span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span><span class="operator">.</span><span class="name">close</span><span class="punctuation">()</span>                   <span class="comment single"># close the file</span></code></pre>
<p>Additionally, the <span class="docutils literal">print()</span> function automatically prints a <span class="docutils literal">&quot;\n&quot;</span>
character, resulting in double spaced printout.</p>
<p>The following is a solution, where the <span class="docutils literal"><span class="pre">end=''</span></span> argument instructs the
<span class="docutils literal">print()</span> function to print an empty <span class="docutils literal">str</span> at the end of the line:</p>
<pre class="code pycon literal-block"><code><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">)</span>
<span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">line</span> <span class="operator word">in</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="generic prompt">... </span>    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">line</span><span class="punctuation">,</span> <span class="name">end</span><span class="operator">=</span><span class="literal string single">''</span><span class="punctuation">)</span>
<span class="generic prompt">...</span>
<span class="generic output">Hayley
Peter
Barney
Stan
Brian
Lois
Marge
Stewie
Francine
Wilma</span></code></pre>
</li>
</ol>
<p>In addition to (or in place of) the above interactive commands, we can collect
these instructions into a Python program file:</p>
<pre class="code python literal-block" id="read-names-from-txt-py"><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln">2 </span>
<span class="ln">3 </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.txt'</span><span class="punctuation">)</span>
<span class="ln">4 </span><span class="keyword">for</span> <span class="name">line</span> <span class="operator word">in</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">5 </span>    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">line</span><span class="punctuation">,</span> <span class="name">end</span><span class="operator">=</span><span class="literal string single">''</span><span class="punctuation">)</span></code></pre>
<p>The program may be executed directly from your IDE or by entering the
following in a terminal:</p>
<pre class="code shell literal-block"><code>python3 read-names-from-txt.py</code></pre>
</div>
<div class="section" id="a-word-about-unicode-and-encoding">
<h2><a class="toc-backref" href="#id30"><span class="sectnum">1.5.</span> A word about Unicode and encoding</a></h2>
<p>The encoding of text files becomes a concern once we want to read and write
text files  with non-ASCII characters, i.e.: letters and symbols which are not
used in the English writing system. (see <a class="citation-reference" href="#ascii1967" id="id2">[ASCII1967]</a>). Here are a few
examples:</p>
<ul class="simple">
<li><p>international characters: Français, Español, Português, Plattdüütsch,
ελληνική, Русский, שפה עברית, հայոց լեզու, 普通話</p></li>
<li><p>emoticons: ☺(grinning face) ☹(sad face)</p></li>
<li><p>and symbols: ❄(snowflake) ✌(V sign) €(euro sign) ⚕(medicine) ☮(peace sign)</p></li>
</ul>
<p>The multitude (dozens!) of character pages and encoding standards used to make
working with -- and especially exchanging -- textual data outside English
speaking countries a daunting challenge. The solution has been gradually
implemented came about in de first decade of the '00s with the widespread
adoption of the Unicode standard (see <a class="citation-reference" href="#unicode2001" id="id3">[Unicode2001]</a>).</p>
<p>In Python 3 the built-in <span class="docutils literal">str</span> datatype (and a few others) has been
re-implemented and strings are now 100% handled as <a class="citation-reference" href="#unicode2001" id="id4">[Unicode2001]</a>. Data
interchange -- i.e.: reading and writing text data -- now typically works to
a degree that users hardly notice it's there.</p>
<p><strong>Important takeaway:</strong></p>
<p>When exchanging textual data, such as reading from or writing to a file,
as a programmer you need to indicate to Python that it should handle the
data as text. This requires a few additional steps before writing or after
reading, which Python will take care of automatically, such as:</p>
<ul class="simple">
<li><p>encoding, i.e.: converting from the <span class="docutils literal">str</span> datatype to raw data and</p></li>
<li><p>decoding, i.e.: converting from raw binary data to the <span class="docutils literal">str</span> type</p></li>
</ul>
<p>In our earlier examples we did this using the <span class="docutils literal">&quot;t&quot;</span> letter code in the
<span class="docutils literal">open()</span> function.</p>
</div>
<div class="section" id="summary">
<h2><a class="toc-backref" href="#id31"><span class="sectnum">1.6.</span> Summary</a></h2>
<p>At this point we have covered the fundamental of reading and writing text
files. The rest of the session we will spend on the most popular formats which
are used to store data in text files.</p>
</div>
</div>
<div class="section" id="working-with-csv-files">
<h1><a class="toc-backref" href="#id32"><span class="sectnum">2.</span> Working with CSV files</a></h1>
<p>The <em>CSV</em> format (see <a class="citation-reference" href="#csvformat" id="id5">[CSVformat]</a>) is a frequently used, application and
platform independent format to exchange tabular data. A typical example:</p>
<pre class="code literal-block"><code><span class="ln">1 </span>name|full_name|group|gendergroup|agegroup
<span class="ln">2 </span>fred|Fred Flintstone|flintstones|m|adults
<span class="ln">3 </span>wilma|Wilma Flintstone|flintstones|f|adults
<span class="ln">4 </span>pebbles|Pebbles Flintstone|flintstones|f|kids</code></pre>
<p>This data represents the following table:</p>
<table class="colwidths-given">
<caption>Cartoon characters</caption>
<colgroup>
<col style="width: 18%" />
<col style="width: 36%" />
<col style="width: 18%" />
<col style="width: 9%" />
<col style="width: 18%" />
</colgroup>
<thead>
<tr><th class="head"><p>name</p></th>
<th class="head"><p>full_name</p></th>
<th class="head"><p>group</p></th>
<th class="head"><p>gendergroup</p></th>
<th class="head"><p>agegroup</p></th>
</tr>
</thead>
<tbody>
<tr><td><p>fred</p></td>
<td><p>Fred Flintstone</p></td>
<td><p>flintstones</p></td>
<td><p>m</p></td>
<td><p>adults</p></td>
</tr>
<tr><td><p>wilma</p></td>
<td><p>Wilma Flintstone</p></td>
<td><p>flintstones</p></td>
<td><p>f</p></td>
<td><p>adults</p></td>
</tr>
<tr><td><p>pebbles</p></td>
<td><p>Pebbles Flintstone</p></td>
<td><p>flintstones</p></td>
<td><p>f</p></td>
<td><p>kids</p></td>
</tr>
</tbody>
</table>
<p>A few noteworthy points about the above example:</p>
<ul class="simple">
<li><p>the first row contains the names of the columns</p></li>
<li><p>the delimiter is the '|' (vertical bar) character</p></li>
<li><p>the data consist of 3 rows and 5 columns</p></li>
<li><p>the strings are not quoted</p></li>
</ul>
<p>In Python there are at least a handful of ways and modules to process <em>CSV</em>
files. We will focus here on the most obvious one: the &quot;Python Standard
Library's&quot; <span class="docutils literal">csv</span> (see <a class="citation-reference" href="#pydoc-csv" id="id6">[pydoc_csv]</a>) module.</p>
<div class="section" id="create-a-csv-file">
<h2><a class="toc-backref" href="#id33"><span class="sectnum">2.1.</span> Create a CSV file</a></h2>
<p>Let's take the above example and create a <em>CSV</em> file from it.</p>
<pre class="code python literal-block" id="write-names-as-csv-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">csv</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="comment single"># The CSV data</span>
<span class="ln"> 6 </span><span class="name">names</span><span class="operator">=</span><span class="literal string single">'''
</span><span class="ln"> 7 </span><span class="literal string single">name|full_name|group|gendergroup|agegroup
</span><span class="ln"> 8 </span><span class="literal string single">fred|Fred Flintstone|flintstones|m|adults
</span><span class="ln"> 9 </span><span class="literal string single">wilma|Wilma Flintstone|flintstones|f|adults
</span><span class="ln">10 </span><span class="literal string single">pebbles|Pebbles Flintstone|flintstones|f|kids
</span><span class="ln">11 </span><span class="literal string single">'''</span>
<span class="ln">12 </span>
<span class="ln">13 </span><span class="comment single"># convert the ``names`` str to a list of lists</span>
<span class="ln">14 </span><span class="name">data</span> <span class="operator">=</span> <span class="name">names</span><span class="operator">.</span><span class="name">strip</span><span class="punctuation">()</span>           <span class="comment single"># remove white-space chars from both ends</span>
<span class="ln">15 </span><span class="name">data</span> <span class="operator">=</span> <span class="name">data</span><span class="operator">.</span><span class="name">split</span><span class="punctuation">(</span><span class="literal string single">'</span><span class="literal string escape">\n</span><span class="literal string single">'</span><span class="punctuation">)</span>        <span class="comment single"># split ``str`` into lines, returns a ``list``</span>
<span class="ln">16 </span><span class="name">data</span> <span class="operator">=</span> <span class="punctuation">[</span> <span class="name">line</span><span class="operator">.</span><span class="name">split</span><span class="punctuation">(</span><span class="literal string single">'|'</span><span class="punctuation">)</span> <span class="keyword">for</span> <span class="name">line</span> <span class="operator word">in</span> <span class="name">data</span> <span class="punctuation">]</span>  <span class="comment single"># split all rows into its fields</span>
<span class="ln">17 </span>
<span class="ln">18 </span><span class="comment single"># the ``data`` variable now points to a list object, each of whose element</span>
<span class="ln">19 </span><span class="comment single"># is a list:</span>
<span class="ln">20 </span><span class="comment single"># data = [</span>
<span class="ln">21 </span><span class="comment single">#   ['name', 'full_name', 'group', 'gendergroup', 'agegroup'],</span>
<span class="ln">22 </span><span class="comment single">#   ['fred', 'Fred Flintstone', 'flintstones', 'm', 'adults'],</span>
<span class="ln">23 </span><span class="comment single">#   ['wilma', 'Wilma Flintstone', 'flintstones', 'f', 'adults'],</span>
<span class="ln">24 </span><span class="comment single">#   ['pebbles', 'Pebbles Flintstone', 'flintstones', 'f', 'kids']</span>
<span class="ln">25 </span><span class="comment single"># ]</span>
<span class="ln">26 </span>
<span class="ln">27 </span><span class="comment single"># Now let's write this out to the file ``names.csv``</span>
<span class="ln">28 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.csv'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">29 </span>   <span class="name">csv_w</span> <span class="operator">=</span> <span class="name">csv</span><span class="operator">.</span><span class="name">writer</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">,</span> <span class="name">dialect</span><span class="operator">=</span><span class="literal string single">'excel'</span><span class="punctuation">,</span> <span class="name">delimiter</span><span class="operator">=</span><span class="literal string single">'|'</span><span class="punctuation">)</span>
<span class="ln">30 </span>   <span class="name">csv_w</span><span class="operator">.</span><span class="name">writerows</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">)</span></code></pre>
<p>The <span class="docutils literal">csv</span> module's &quot;Dialects and Formatting Parameters&quot; section (see
<a class="citation-reference" href="#pydoc-csv-formatting" id="id7">[pydoc_csv_formatting]</a>) provides more information about additional bells and
whistles when exporting data to <em>CSV</em>, e.g.:</p>
<ul class="simple">
<li><p><span class="docutils literal">quoting</span>: whether or not to quote strings</p></li>
<li><p><span class="docutils literal">escapechar</span>: how to escape characters in the data, which coincide with
the <span class="docutils literal">delimiter</span> character</p></li>
<li><p>etc ...</p></li>
</ul>
<p>Execute this program by entering:</p>
<pre class="code shell literal-block"><code>python3 write-names-as-csv.py</code></pre>
<p>and verify the file it has produced:</p>
<pre class="code shell literal-block"><code>cat names.csv

name<span class="punctuation">|</span>full_name<span class="punctuation">|</span>group<span class="punctuation">|</span>gendergroup<span class="punctuation">|</span>agegroup
fred<span class="punctuation">|</span>Fred Flintstone<span class="punctuation">|</span>flintstones<span class="punctuation">|</span>m<span class="punctuation">|</span>adults
wilma<span class="punctuation">|</span>Wilma Flintstone<span class="punctuation">|</span>flintstones<span class="punctuation">|</span>f<span class="punctuation">|</span>adults
pebbles<span class="punctuation">|</span>Pebbles Flintstone<span class="punctuation">|</span>flintstones<span class="punctuation">|</span>f<span class="punctuation">|</span>kids</code></pre>
</div>
<div class="section" id="read-data-from-a-csv-files">
<h2><a class="toc-backref" href="#id34"><span class="sectnum">2.2.</span> Read data from a CSV files</a></h2>
<p>Now that we have an example <em>CSV</em> example, we can re-create the Python data
structure from the data:</p>
<pre class="code python literal-block" id="read-names-from-csv-py"><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln">2 </span>
<span class="ln">3 </span><span class="keyword namespace">import</span> <span class="name namespace">csv</span>
<span class="ln">4 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.csv'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">5 </span>    <span class="name">csv_r</span> <span class="operator">=</span> <span class="name">csv</span><span class="operator">.</span><span class="name">reader</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">,</span> <span class="name">dialect</span><span class="operator">=</span><span class="literal string single">'excel'</span><span class="punctuation">,</span> <span class="name">delimiter</span><span class="operator">=</span><span class="literal string single">'|'</span><span class="punctuation">)</span>
<span class="ln">6 </span>    <span class="name">data</span> <span class="operator">=</span> <span class="name builtin">list</span><span class="punctuation">(</span><span class="name">csv_r</span><span class="punctuation">)</span>
<span class="ln">7 </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">)</span></code></pre>
<p>The steps:</p>
<ul>
<li><p><strong>line 3:</strong> load the <span class="docutils literal">csv</span> module</p></li>
<li><p><strong>line 4:</strong> the <span class="docutils literal">with</span> statement is an improved way of using (amongst
others) the <span class="docutils literal">open()</span> function, which will automatically close the file
handler if Python is done with the code block (lines 5 and 6)</p>
<p>For detailed information on this construct see the <a class="citation-reference" href="#pep343" id="id8">[pep343]</a> or search for
the term &quot;python context manager&quot;.</p>
</li>
<li><p><strong>line 5:</strong> create a new CSV reader object with the specified details about
the delimiter and CSV dialect</p></li>
<li><p><strong>line 6:</strong> convert the data represented by the CSV reader to a list object</p></li>
<li><p><strong>line 7:</strong> print out the data</p></li>
</ul>
</div>
</div>
<div class="section" id="working-with-ini-files">
<h1><a class="toc-backref" href="#id35"><span class="sectnum">3.</span> Working with INI files</a></h1>
<p>The <em>INI</em> format (see <a class="citation-reference" href="#ini-format" id="id9">[INI_format]</a>) is capable of representing information
organized in a tree structure, which lends itself well for its main use case:
configuration files. Besides that the <em>INI</em> format can also be used for data
exchange.</p>
<p>Similarly to the <em>CSV</em> format despite of lacking an official standard, it has
been in use for decades and as a result has a multitude of (slightly
inconsistent) implementations.</p>
<p>In terms of the format's details, the content is divided into sections, which
in turn is a listing of properties and their associated values.</p>
<p>Python has an implementation in the &quot;Python Standard Library&quot; in the module
<span class="docutils literal">configparser</span> (see <a class="citation-reference" href="#pydoc-configparser" id="id10">[pydoc_configparser]</a>).</p>
<p>In Python terminology, while the <em>CSV</em> format is well-suited for storing
<span class="docutils literal">list</span>-like data, the <em>INI</em> format is a good choice for storing
<span class="docutils literal">dict</span>-like data.</p>
<p>In this section we will be working with the data represented by the following
<span class="docutils literal">dict</span> object:</p>
<blockquote>
<pre class="code python literal-block"><code><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
          <span class="literal string single">'kids'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                    <span class="literal string single">'Chris'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
                    <span class="literal string single">'Pebbles'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
                    <span class="literal string single">'Bart'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span>
                  <span class="punctuation">},</span>
          <span class="literal string single">'adults'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
                      <span class="literal string single">'Fred'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
                      <span class="literal string single">'Betty'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
                      <span class="literal string single">'Homer'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span><span class="punctuation">,</span>
                      <span class="literal string single">'Lois'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span>
                    <span class="punctuation">},</span>
          <span class="literal string single">'other'</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="literal string single">'Klaus'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span><span class="punctuation">,</span>
                     <span class="literal string single">'Brian'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
                     <span class="literal string single">'Roger'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span>
                   <span class="punctuation">}</span>
        <span class="punctuation">}</span></code></pre>
</blockquote>
<div class="section" id="writing-data-to-ini-file">
<h2><a class="toc-backref" href="#id36"><span class="sectnum">3.1.</span> Writing data to INI file</a></h2>
<p>The following is one of the simplest solution to export to an INI file:</p>
<pre class="code python literal-block" id="write-names-as-ini-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">configparser</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
<span class="ln"> 6 </span>          <span class="literal string single">'kids'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>                    <span class="literal string single">'Chris'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                    <span class="literal string single">'Pebbles'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                    <span class="literal string single">'Bart'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span>
<span class="ln">10 </span>                  <span class="punctuation">},</span>
<span class="ln">11 </span>          <span class="literal string single">'adults'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln">12 </span>                      <span class="literal string single">'Fred'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">13 </span>                      <span class="literal string single">'Betty'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">14 </span>                      <span class="literal string single">'Homer'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span><span class="punctuation">,</span>
<span class="ln">15 </span>                      <span class="literal string single">'Lois'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span>
<span class="ln">16 </span>                    <span class="punctuation">},</span>
<span class="ln">17 </span>          <span class="literal string single">'other'</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="literal string single">'Klaus'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span><span class="punctuation">,</span>
<span class="ln">18 </span>                     <span class="literal string single">'Brian'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln">19 </span>                     <span class="literal string single">'Roger'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span>
<span class="ln">20 </span>                   <span class="punctuation">}</span>
<span class="ln">21 </span>        <span class="punctuation">}</span>
<span class="ln">22 </span><span class="name">ini</span> <span class="operator">=</span> <span class="name">configparser</span><span class="operator">.</span><span class="name">ConfigParser</span><span class="punctuation">()</span>
<span class="ln">23 </span><span class="name">ini</span><span class="operator">.</span><span class="name">update</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">)</span>
<span class="ln">24 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.ini'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">25 </span>   <span class="name">ini</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">)</span></code></pre>
<p>When executing this example, it creates the <span class="docutils literal">names.ini</span> file with  the
following content:</p>
<pre class="code ini literal-block"><code><span class="keyword">[kids]</span>
<span class="name attribute">chris</span> <span class="operator">=</span> <span class="literal string">Family Guy</span>
<span class="name attribute">pebbles</span> <span class="operator">=</span> <span class="literal string">The Flintstones</span>
<span class="name attribute">bart</span> <span class="operator">=</span> <span class="literal string">The Simpsons</span>

<span class="keyword">[adults]</span>
<span class="name attribute">fred</span> <span class="operator">=</span> <span class="literal string">The Flintstones</span>
<span class="name attribute">betty</span> <span class="operator">=</span> <span class="literal string">The Flintstones</span>
<span class="name attribute">homer</span> <span class="operator">=</span> <span class="literal string">The Simpsons</span>
<span class="name attribute">lois</span> <span class="operator">=</span> <span class="literal string">Family Guy</span>

<span class="keyword">[other]</span>
<span class="name attribute">klaus</span> <span class="operator">=</span> <span class="literal string">American Dad</span>
<span class="name attribute">brian</span> <span class="operator">=</span> <span class="literal string">Family Guy</span>
<span class="name attribute">roger</span> <span class="operator">=</span> <span class="literal string">American Dad</span></code></pre>
<p>Note the lower-case key names (e.g.: 'chris', 'pebbles' etc...). This is the
default behavior of the <span class="docutils literal">ConfigParser</span> class, since the original
implementation of the <span class="docutils literal">configparser</span> module tried to adhere the <em>INI</em> format
used on Windows. Windows is case-insensitive, hence the class' default
behavior.</p>
<p>With the following slight modification we can preserve the upper-case letters:</p>
<pre class="code python literal-block" id="write-names-as-ini-preserve-case-py"><span id="cartooncharacters"></span><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">configparser</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
<span class="ln"> 6 </span>          <span class="literal string single">'kids'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>                    <span class="literal string single">'Chris'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                    <span class="literal string single">'Pebbles'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                    <span class="literal string single">'Bart'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span>
<span class="ln">10 </span>                  <span class="punctuation">},</span>
<span class="ln">11 </span>          <span class="literal string single">'adults'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln">12 </span>                      <span class="literal string single">'Fred'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">13 </span>                      <span class="literal string single">'Betty'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">14 </span>                      <span class="literal string single">'Homer'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span><span class="punctuation">,</span>
<span class="ln">15 </span>                      <span class="literal string single">'Lois'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span>
<span class="ln">16 </span>                    <span class="punctuation">},</span>
<span class="ln">17 </span>          <span class="literal string single">'other'</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="literal string single">'Klaus'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span><span class="punctuation">,</span>
<span class="ln">18 </span>                     <span class="literal string single">'Brian'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln">19 </span>                     <span class="literal string single">'Roger'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span>
<span class="ln">20 </span>                   <span class="punctuation">}</span>
<span class="ln">21 </span>        <span class="punctuation">}</span>
<span class="ln">22 </span><span class="name">ini</span> <span class="operator">=</span> <span class="name">configparser</span><span class="operator">.</span><span class="name">ConfigParser</span><span class="punctuation">()</span>
<span class="ln">23 </span><span class="name">ini</span><span class="operator">.</span><span class="name">optionxform</span> <span class="operator">=</span> <span class="name builtin">str</span>               <span class="comment single"># make sure to preserve case!</span>
<span class="ln">24 </span><span class="name">ini</span><span class="operator">.</span><span class="name">update</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">)</span>
<span class="ln">25 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names-case-preserved.ini'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">26 </span>   <span class="name">ini</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">)</span></code></pre>
<p>A few details of this improved version:</p>
<ul class="simple">
<li><p><strong>line 3:</strong> load the <span class="docutils literal">configparser</span> module</p></li>
<li><p><strong>line 22:</strong> create a new <span class="docutils literal">ConfigParser</span> object</p></li>
<li><p><strong>line 23:</strong> make sure to preserve upper- and lower-cases in both section-
and key names!</p></li>
<li><p><strong>line 24:</strong> copy the data from the <span class="docutils literal">names</span> dictionary object</p></li>
<li><p><strong>line 25:</strong> open the output file  (as a reminder: see <a class="citation-reference" href="#pep343" id="id11">[pep343]</a> for more
information on using context managers)</p></li>
<li><p><strong>line 26:</strong> write the data to the output file</p></li>
</ul>
</div>
<div class="section" id="reading-data-from-ini-files">
<h2><a class="toc-backref" href="#id37"><span class="sectnum">3.2.</span> Reading data from INI files</a></h2>
<p>As usual, we'll try to read in the data from the file we just created.</p>
<pre class="code python literal-block" id="read-names-from-ini-py"><span id="readinifile"></span><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env pythone</span>
<span class="ln">2 </span>
<span class="ln">3 </span><span class="keyword namespace">import</span> <span class="name namespace">configparser</span>
<span class="ln">4 </span><span class="name">ini</span> <span class="operator">=</span> <span class="name">configparser</span><span class="operator">.</span><span class="name">ConfigParser</span><span class="punctuation">()</span>
<span class="ln">5 </span><span class="name">ini</span><span class="operator">.</span><span class="name">optionxform</span> <span class="operator">=</span> <span class="name builtin">str</span>               <span class="comment single"># make sure to preserve case!</span>
<span class="ln">6 </span><span class="name">files_read</span> <span class="operator">=</span> <span class="name">ini</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">([</span><span class="literal string single">'names-case-preserved.ini'</span><span class="punctuation">])</span>
<span class="ln">7 </span><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="name">section</span><span class="punctuation">:</span><span class="name builtin">dict</span><span class="punctuation">(</span><span class="name">ini</span><span class="punctuation">[</span><span class="name">section</span><span class="punctuation">])</span> <span class="keyword">for</span> <span class="name">section</span> <span class="operator word">in</span> <span class="name">ini</span><span class="operator">.</span><span class="name">sections</span><span class="punctuation">()</span> <span class="punctuation">}</span>
<span class="ln">8 </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">)</span></code></pre>
<p>So let's unpack what has happened here:</p>
<ul>
<li><p><strong>lines 3, 4 and 5:</strong> load the <span class="docutils literal">configparser</span> module, create a new
<span class="docutils literal">ConfigParser</span> object and make sure it preserves upper- and lower-case
letters ; same as in the previous example</p></li>
<li><p><strong>line 5:</strong> the <span class="docutils literal">.read()</span> method is an interesting one... it is capable of
reading, parsing and merging multiple <em>INI</em> files in one go.</p>
<p>As its argument we provide a collection (in this case a <span class="docutils literal">list</span>) of
strings, which will be interpreted by the method as file names. The
<span class="docutils literal">.read()</span> method will try to read and parse them.</p>
<p>The names of all successfully processed files will be provided as the
elements of the <span class="docutils literal">list</span> object it returns.</p>
<p><strong>Very convenient!</strong></p>
</li>
<li><p><strong>line 6:</strong> this is where we convert the <span class="docutils literal">ConfigParser</span> object to
a <span class="docutils literal">dict</span>. This is not required, since we can access the data in the
<span class="docutils literal">ini</span> object as well. However for an easy comparison with what we've
started it is convenient to see the data as a <span class="docutils literal">dict</span></p>
<p>The conversion is done using a &quot;dictionary comprehension&quot; (see <a class="citation-reference" href="#pep274" id="id12">[pep274]</a>),
which is a convenient shorthand for a full-blown <span class="docutils literal">for</span> loop.</p>
<p>To unpack its working we could write the instruction up in a way which
better indicates the details:</p>
<pre class="code python literal-block"><code><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
 <span class="name">section</span>                          <span class="comment single"># key of the new element is the section name</span>
 <span class="punctuation">:</span>                                <span class="comment single"># required syntax</span>
 <span class="name builtin">dict</span><span class="punctuation">(</span><span class="name">ini</span><span class="punctuation">[</span><span class="name">section</span><span class="punctuation">])</span>               <span class="comment single"># value is the converted ``Section``</span>
                                  <span class="comment single"># object to a ``dict``</span>
 <span class="keyword">for</span> <span class="name">section</span> <span class="operator word">in</span> <span class="name">ini</span><span class="operator">.</span><span class="name">sections</span><span class="punctuation">()</span>    <span class="comment single"># loop through each section name</span>
<span class="punctuation">}</span></code></pre>
</li>
<li><p><strong>line 7:</strong> display the data</p></li>
</ul>
<p>When we execute this program we see the following:</p>
<pre class="code shell literal-block"><code>python3 read-names-from-ini.py

<span class="operator">{</span><span class="literal string single">'kids'</span>: <span class="operator">{</span><span class="literal string single">'Chris'</span>: <span class="literal string single">'Family Guy'</span>, <span class="literal string single">'Pebbles'</span>: <span class="literal string single">'The Flintstones'</span>, <span class="literal string single">'Bart'</span>: <span class="literal string single">'The
Simpsons'</span><span class="operator">}</span>, <span class="literal string single">'adults'</span>: <span class="operator">{</span><span class="literal string single">'Fred'</span>: <span class="literal string single">'The Flintstones'</span>, <span class="literal string single">'Betty'</span>: <span class="literal string single">'The
Flintstones'</span>, <span class="literal string single">'Homer'</span>: <span class="literal string single">'The Simpsons'</span>, <span class="literal string single">'Lois'</span>: <span class="literal string single">'Family Guy'</span><span class="operator">}</span>, <span class="literal string single">'other'</span>:
<span class="operator">{</span><span class="literal string single">'Klaus'</span>: <span class="literal string single">'American Dad'</span>, <span class="literal string single">'Brian'</span>: <span class="literal string single">'Family Guy'</span>, <span class="literal string single">'Roger'</span>: <span class="literal string single">'American Dad'</span><span class="operator">}}</span></code></pre>
</div>
<div class="section" id="writing-configuration-data-to-ini-files">
<h2><a class="toc-backref" href="#id38"><span class="sectnum">3.3.</span> Writing configuration data to INI files</a></h2>
<p>Using the <em>INI</em> format for configuration data is not significantly different
and most of the differences arise from conventions after decades of use.</p>
<p>Create a new configuration file based on the example at
<a class="reference external" href="https://docs.python.org/3/library/configparser.html#quick-start">https://docs.python.org/3/library/configparser.html#quick-start</a></p>
<pre class="code python literal-block" id="write-cfg-as-ini-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">configparser</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="name">cfg</span> <span class="operator">=</span> <span class="name">configparser</span><span class="operator">.</span><span class="name">ConfigParser</span><span class="punctuation">()</span>
<span class="ln"> 6 </span><span class="name">cfg</span><span class="operator">.</span><span class="name">optionxform</span> <span class="operator">=</span> <span class="name builtin">str</span>               <span class="comment single"># make sure to preserve case!</span>
<span class="ln"> 7 </span>
<span class="ln"> 8 </span><span class="comment single"># add the DEFAULT section</span>
<span class="ln"> 9 </span><span class="name">cfg</span><span class="punctuation">[</span><span class="literal string single">'DEFAULT'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{</span><span class="literal string single">'ServerAliveInterval'</span><span class="punctuation">:</span> <span class="literal number integer">45</span><span class="punctuation">,</span>
<span class="ln">10 </span>                  <span class="literal string single">'Compression'</span><span class="punctuation">:</span> <span class="literal string single">'yes'</span><span class="punctuation">,</span>
<span class="ln">11 </span>                  <span class="literal string single">'CompressionLevel'</span><span class="punctuation">:</span> <span class="literal number integer">9</span><span class="punctuation">,</span>
<span class="ln">12 </span>                  <span class="literal string single">'ForwardX11'</span><span class="punctuation">:</span> <span class="literal string single">'yes'</span><span class="punctuation">}</span>
<span class="ln">13 </span>
<span class="ln">14 </span><span class="comment single"># add a new section</span>
<span class="ln">15 </span><span class="name">cfg</span><span class="punctuation">[</span><span class="literal string single">'bitbucket.org'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{}</span>
<span class="ln">16 </span><span class="name">cfg</span><span class="punctuation">[</span><span class="literal string single">'bitbucket.org'</span><span class="punctuation">][</span><span class="literal string single">'User'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal string single">'hg'</span>
<span class="ln">17 </span>
<span class="ln">18 </span><span class="comment single"># another new section</span>
<span class="ln">19 </span><span class="name">cfg</span><span class="punctuation">[</span><span class="literal string single">'topsecret.server.com'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="punctuation">{}</span>
<span class="ln">20 </span><span class="name">topsecret</span> <span class="operator">=</span> <span class="name">cfg</span><span class="punctuation">[</span><span class="literal string single">'topsecret.server.com'</span><span class="punctuation">]</span>
<span class="ln">21 </span><span class="name">topsecret</span><span class="punctuation">[</span><span class="literal string single">'Port'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal string single">'50022'</span>
<span class="ln">22 </span><span class="name">topsecret</span><span class="punctuation">[</span><span class="literal string single">'ForwardX11'</span><span class="punctuation">]</span> <span class="operator">=</span> <span class="literal string single">'no'</span>
<span class="ln">23 </span>
<span class="ln">24 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'servers.ini'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">25 </span>   <span class="name">cfg</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">)</span></code></pre>
<p>This creates the following <em>INI</em> file:</p>
<pre class="code ini literal-block" id="servers-ini"><span id="serversini"></span><code><span class="keyword">[DEFAULT]</span>
<span class="name attribute">ServerAliveInterval</span> <span class="operator">=</span> <span class="literal string">45</span>
<span class="name attribute">Compression</span> <span class="operator">=</span> <span class="literal string">yes</span>
<span class="name attribute">CompressionLevel</span> <span class="operator">=</span> <span class="literal string">9</span>
<span class="name attribute">ForwardX11</span> <span class="operator">=</span> <span class="literal string">yes</span>

<span class="keyword">[bitbucket.org]</span>
<span class="name attribute">User</span> <span class="operator">=</span> <span class="literal string">hg</span>

<span class="keyword">[topsecret.server.com]</span>
<span class="name attribute">Port</span> <span class="operator">=</span> <span class="literal string">50022</span>
<span class="name attribute">ForwardX11</span> <span class="operator">=</span> <span class="literal string">no</span></code></pre>
</div>
<div class="section" id="more-advanced-use-case-merging-of-multiple-configuration-files">
<h2><a class="toc-backref" href="#id39"><span class="sectnum">3.4.</span> More advanced use-case: Merging of multiple configuration files</a></h2>
<p>Suppose that for the reason of separating out concerns, we have decided to
split up our configuration information into the following 2 files:</p>
<ul class="simple">
<li><p><span class="docutils literal">servers.ini</span> from the <a class="reference external" href="#serversini">earlier example</a>, containing
generic server related configuration, and</p></li>
<li><p><span class="docutils literal">user.ini</span> containing the specific preferences of a user as follows:</p></li>
</ul>
<pre class="code ini literal-block" id="user-ini"><code><span class="keyword">[DEFAULT]</span>
<span class="name attribute">ServerAliveInterval</span> <span class="operator">=</span> <span class="literal string">200</span>
<span class="name attribute">ForwardX11</span> <span class="operator">=</span> <span class="literal string">no</span>

<span class="keyword">[www.example.com]</span>
<span class="name attribute">User</span> <span class="operator">=</span> <span class="literal string">jdoe</span></code></pre>
<p>A slightly modified version of our <a class="reference external" href="#readinifile">earlier *INI* reader example</a> will read and merge both the <span class="docutils literal">servers.ini</span></p>
<pre class="code python literal-block" id="read-multiple-ini-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env pythone</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">configparser</span>
<span class="ln"> 4 </span><span class="name">ini</span> <span class="operator">=</span> <span class="name">configparser</span><span class="operator">.</span><span class="name">ConfigParser</span><span class="punctuation">()</span>
<span class="ln"> 5 </span><span class="name">ini</span><span class="operator">.</span><span class="name">optionxform</span> <span class="operator">=</span> <span class="name builtin">str</span>               <span class="comment single"># make sure to preserve case!</span>
<span class="ln"> 6 </span><span class="name">files_read</span> <span class="operator">=</span> <span class="name">ini</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">([</span><span class="literal string single">'servers.ini'</span><span class="punctuation">,</span> <span class="literal string single">'user.ini'</span><span class="punctuation">])</span>
<span class="ln"> 7 </span><span class="name">cfg</span> <span class="operator">=</span> <span class="punctuation">{</span> <span class="name">section</span><span class="punctuation">:</span><span class="name builtin">dict</span><span class="punctuation">(</span><span class="name">ini</span><span class="punctuation">[</span><span class="name">section</span><span class="punctuation">])</span>
<span class="ln"> 8 </span>        <span class="keyword">for</span> <span class="name">section</span> <span class="operator word">in</span> <span class="name">ini</span><span class="operator">.</span><span class="name">sections</span><span class="punctuation">()</span> <span class="operator">+</span> <span class="punctuation">[</span><span class="literal string single">'DEFAULT'</span><span class="punctuation">]</span> <span class="punctuation">}</span>
<span class="ln"> 9 </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">cfg</span><span class="punctuation">)</span></code></pre>
<p>This program produces the following output (slightly re-formatted for
readability):</p>
<pre class="code shell literal-block"><code>python3 -i read-multiple-ini.py

<span class="operator">{</span>
  <span class="literal string single">'bitbucket.org'</span>: <span class="operator">{</span>
     <span class="literal string single">'User'</span>: <span class="literal string single">'hg'</span>, <span class="literal string single">'ServerAliveInterval'</span>: <span class="literal string single">'200'</span>, <span class="literal string single">'Compression'</span>: <span class="literal string single">'yes'</span>,
     <span class="literal string single">'CompressionLevel'</span>: <span class="literal string single">'9'</span>, <span class="literal string single">'ForwardX11'</span>: <span class="literal string single">'no'</span><span class="operator">}</span>,
  <span class="literal string single">'topsecret.server.com'</span>: <span class="operator">{</span>
     <span class="literal string single">'Port'</span>: <span class="literal string single">'50022'</span>, <span class="literal string single">'ForwardX11'</span>: <span class="literal string single">'no'</span>, <span class="literal string single">'ServerAliveInterval'</span>: <span class="literal string single">'200'</span>,
     <span class="literal string single">'Compression'</span>: <span class="literal string single">'yes'</span>, <span class="literal string single">'CompressionLevel'</span>: <span class="literal string single">'9'</span><span class="operator">}</span>,
  <span class="literal string single">'www.example.com'</span>: <span class="operator">{</span>
     <span class="literal string single">'User'</span>: <span class="literal string single">'jdoe'</span>, <span class="literal string single">'ServerAliveInterval'</span>: <span class="literal string single">'200'</span>, <span class="literal string single">'Compression'</span>: <span class="literal string single">'yes'</span>,
     <span class="literal string single">'CompressionLevel'</span>: <span class="literal string single">'9'</span>, <span class="literal string single">'ForwardX11'</span>: <span class="literal string single">'no'</span><span class="operator">}</span>,
  <span class="literal string single">'DEFAULT'</span>: <span class="operator">{</span>
     <span class="literal string single">'ServerAliveInterval'</span>: <span class="literal string single">'200'</span>, <span class="literal string single">'Compression'</span>: <span class="literal string single">'yes'</span>,
     <span class="literal string single">'CompressionLevel'</span>: <span class="literal string single">'9'</span>, <span class="literal string single">'ForwardX11'</span>: <span class="literal string single">'no'</span><span class="operator">}</span>
<span class="operator">}</span></code></pre>
<p>Note that some of the entries defined in <span class="docutils literal">servers.ini</span> are overwritten by
the matching entries in <span class="docutils literal">user.ini</span> and there is also a new section:</p>
<ul class="simple">
<li><p>changes in the <span class="docutils literal">[DEFAULT]</span> section:</p>
<ul>
<li><p>value change of <span class="docutils literal">ServerAliveInterval</span>: <span class="docutils literal">45</span> -&gt; <span class="docutils literal">200</span></p></li>
<li><p>value change of <span class="docutils literal">ForwardX11</span>: <span class="docutils literal">yes</span> -&gt; <span class="docutils literal">no</span></p></li>
</ul>
</li>
<li><p>new section <span class="docutils literal">www.example.com</span></p></li>
</ul>
</div>
<div class="section" id="more-advanced-use-case-interpolation-of-configuration-files">
<h2><a class="toc-backref" href="#id40"><span class="sectnum">3.5.</span> More advanced use-case: Interpolation of configuration files</a></h2>
<p>For more information see the following section of the <span class="docutils literal">configparser</span>
module's documentation:</p>
<p><a class="reference external" href="https://docs.python.org/3/library/configparser.html#interpolation-of-values">https://docs.python.org/3/library/configparser.html#interpolation-of-values</a></p>
</div>
</div>
<div class="section" id="working-with-json-files">
<h1><a class="toc-backref" href="#id41"><span class="sectnum">4.</span> Working with JSON files</a></h1>
<p>The <em>JSON</em> file format (see <a class="citation-reference" href="#json" id="id13">[JSON]</a>) is an ECMA open standard well-suited for
exchanging tree-like data in a human-readable text format. <em>JSON</em> is widely
used for storing both configuration information and actual data.</p>
<div class="section" id="json-support-in-python">
<h2><a class="toc-backref" href="#id42"><span class="sectnum">4.1.</span> JSON support in Python</a></h2>
<p>The &quot;Python Standard Library&quot; provides out-of-the-box <em>JSON</em> support in the
<span class="docutils literal">json</span> modules.</p>
</div>
<div class="section" id="writing-data-to-json-file">
<h2><a class="toc-backref" href="#id43"><span class="sectnum">4.2.</span> Writing data to JSON file</a></h2>
<p>Let's take the <a class="reference external" href="#cartooncharacters">cartoon characters data</a>  from the
<span class="docutils literal">names</span> dictionary of our earlier example and export it to a <em>JSON</em> file:</p>
<pre class="code python literal-block" id="write-names-as-json-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">json</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
<span class="ln"> 6 </span>          <span class="literal string single">'kids'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>                    <span class="literal string single">'Chris'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                    <span class="literal string single">'Pebbles'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                    <span class="literal string single">'Bart'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span>
<span class="ln">10 </span>                  <span class="punctuation">},</span>
<span class="ln">11 </span>          <span class="literal string single">'adults'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln">12 </span>                      <span class="literal string single">'Fred'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">13 </span>                      <span class="literal string single">'Betty'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">14 </span>                      <span class="literal string single">'Homer'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span><span class="punctuation">,</span>
<span class="ln">15 </span>                      <span class="literal string single">'Lois'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span>
<span class="ln">16 </span>                    <span class="punctuation">},</span>
<span class="ln">17 </span>          <span class="literal string single">'other'</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="literal string single">'Klaus'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span><span class="punctuation">,</span>
<span class="ln">18 </span>                     <span class="literal string single">'Brian'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln">19 </span>                     <span class="literal string single">'Roger'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span>
<span class="ln">20 </span>                   <span class="punctuation">}</span>
<span class="ln">21 </span>        <span class="punctuation">}</span>
<span class="ln">22 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.json'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">23 </span>   <span class="name">json</span><span class="operator">.</span><span class="name">dump</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">,</span> <span class="name">fh</span><span class="punctuation">)</span></code></pre>
<p>Focusing on the new instructions:</p>
<ul class="simple">
<li><p><strong>line 3:</strong> load the <span class="docutils literal">json</span> module</p></li>
<li><p><strong>line 23:</strong> the <span class="docutils literal">json.dump()</span> takes 2 arguments: the data structure
(usually as a <span class="docutils literal">dict</span>) and a file-handler</p></li>
</ul>
<p>The program produces the <span class="docutils literal">&quot;names.json&quot;</span> file with the following content
(re-formatted for readability):</p>
<pre class="code json literal-block" id="names-json"><code><span class="punctuation">{</span>
  <span class="name tag">&quot;kids&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;Chris&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Family Guy&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Pebbles&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;The Flintstones&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Bart&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;The Simpsons&quot;</span>
  <span class="punctuation">},</span>
  <span class="name tag">&quot;adults&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;Fred&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;The Flintstones&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Betty&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;The Flintstones&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Homer&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;The Simpsons&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Lois&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Family Guy&quot;</span>
  <span class="punctuation">},</span>
  <span class="name tag">&quot;other&quot;</span><span class="punctuation">:</span> <span class="punctuation">{</span>
    <span class="name tag">&quot;Klaus&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;American Dad&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Brian&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;Family Guy&quot;</span><span class="punctuation">,</span>
    <span class="name tag">&quot;Roger&quot;</span><span class="punctuation">:</span> <span class="literal string double">&quot;American Dad&quot;</span>
  <span class="punctuation">}</span>
<span class="punctuation">}</span></code></pre>
<p>Note the striking similarities in the syntax of the <em>JSON</em> format and the
actual Python syntax of dictionaries! Almost exactly the same.</p>
</div>
<div class="section" id="reading-data-from-json-files">
<h2><a class="toc-backref" href="#id44"><span class="sectnum">4.3.</span> Reading data from JSON files</a></h2>
<p>Loading a <em>JSON</em> file is fairly trivial with Python's  <span class="docutils literal">json</span> module:</p>
<pre class="code python literal-block" id="read-names-from-json-py"><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env pythone</span>
<span class="ln">2 </span>
<span class="ln">3 </span><span class="keyword namespace">import</span> <span class="name namespace">json</span>
<span class="ln">4 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.json'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">5 </span>   <span class="name">names</span> <span class="operator">=</span> <span class="name">json</span><span class="operator">.</span><span class="name">load</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">)</span>
<span class="ln">6 </span>   <span class="keyword">print</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">)</span></code></pre>
<p>Output (re-formatted):</p>
<pre class="code shell literal-block"><code>python3 read-names-from-json.py

<span class="operator">{</span>
  <span class="literal string single">'kids'</span>: <span class="operator">{</span>
    <span class="literal string single">'Chris'</span>: <span class="literal string single">'Family Guy'</span>, <span class="literal string single">'Pebbles'</span>: <span class="literal string single">'The Flintstones'</span>,
    <span class="literal string single">'Bart'</span>: <span class="literal string single">'The Simpsons'</span>
  <span class="operator">}</span>,
  <span class="literal string single">'adults'</span>: <span class="operator">{</span>
    <span class="literal string single">'Fred'</span>: <span class="literal string single">'The Flintstones'</span>, <span class="literal string single">'Betty'</span>: <span class="literal string single">'The Flintstones'</span>,
    <span class="literal string single">'Homer'</span>: <span class="literal string single">'The Simpsons'</span>, <span class="literal string single">'Lois'</span>: <span class="literal string single">'Family Guy'</span>
  <span class="operator">}</span>,
  <span class="literal string single">'other'</span>: <span class="operator">{</span>
    <span class="literal string single">'Klaus'</span>: <span class="literal string single">'American Dad'</span>, <span class="literal string single">'Brian'</span>: <span class="literal string single">'Family Guy'</span>, <span class="literal string single">'Roger'</span>: <span class="literal string single">'American Dad'</span>
  <span class="operator">}</span>
<span class="operator">}</span></code></pre>
</div>
</div>
<div class="section" id="working-with-yaml-files">
<h1><a class="toc-backref" href="#id45"><span class="sectnum">5.</span> Working with YAML files</a></h1>
<p>In terms of purpose the <a class="citation-reference" href="#yaml" id="id14">[YAML]</a> format is quite similar to <em>JSON</em>, except for
two aspects:</p>
<ul class="simple">
<li><p>its improved readability</p></li>
<li><p>provides richer data serialization capabilities</p></li>
</ul>
<p>One of the most notable usage for of the <em>YAML</em> format in the Python ecosystem
is the <a class="citation-reference" href="#ansible" id="id15">[Ansible]</a> configuration management solution.</p>
<div class="section" id="yaml-support-in-python">
<h2><a class="toc-backref" href="#id46"><span class="sectnum">5.1.</span> YAML support in Python</a></h2>
<p>Currently the &quot;Python Standard Library&quot; does not have <em>YAML</em> support.
Fortunately there are multiple 3rd party modules, which can be easy installed
using the <span class="docutils literal">pip</span> package management tool.</p>
<p>Perhaps the most popular solution is provided by the <a class="citation-reference" href="#pyyaml" id="id16">[PyYAML]</a> project. To
install the module execute:</p>
<pre class="code shell literal-block"><code>pip install pyyaml</code></pre>
</div>
<div class="section" id="writing-data-to-a-yaml-file">
<h2><a class="toc-backref" href="#id47"><span class="sectnum">5.2.</span> Writing data to a YAML file</a></h2>
<p>Re-using the cartoon characters <a class="reference external" href="#cartooncharacters">data</a> we can export the
<span class="docutils literal">names</span> dictionary with the following simple code:</p>
<pre class="code python literal-block" id="write-names-as-yaml-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">yaml</span>
<span class="ln"> 4 </span>
<span class="ln"> 5 </span><span class="name">names</span> <span class="operator">=</span> <span class="punctuation">{</span>
<span class="ln"> 6 </span>          <span class="literal string single">'kids'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln"> 7 </span>                    <span class="literal string single">'Chris'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln"> 8 </span>                    <span class="literal string single">'Pebbles'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln"> 9 </span>                    <span class="literal string single">'Bart'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span>
<span class="ln">10 </span>                  <span class="punctuation">},</span>
<span class="ln">11 </span>          <span class="literal string single">'adults'</span><span class="punctuation">:</span> <span class="punctuation">{</span>
<span class="ln">12 </span>                      <span class="literal string single">'Fred'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">13 </span>                      <span class="literal string single">'Betty'</span><span class="punctuation">:</span> <span class="literal string single">'The Flintstones'</span><span class="punctuation">,</span>
<span class="ln">14 </span>                      <span class="literal string single">'Homer'</span><span class="punctuation">:</span> <span class="literal string single">'The Simpsons'</span><span class="punctuation">,</span>
<span class="ln">15 </span>                      <span class="literal string single">'Lois'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span>
<span class="ln">16 </span>                    <span class="punctuation">},</span>
<span class="ln">17 </span>          <span class="literal string single">'other'</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="literal string single">'Klaus'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span><span class="punctuation">,</span>
<span class="ln">18 </span>                     <span class="literal string single">'Brian'</span><span class="punctuation">:</span> <span class="literal string single">'Family Guy'</span><span class="punctuation">,</span>
<span class="ln">19 </span>                     <span class="literal string single">'Roger'</span><span class="punctuation">:</span> <span class="literal string single">'American Dad'</span>
<span class="ln">20 </span>                   <span class="punctuation">}</span>
<span class="ln">21 </span>        <span class="punctuation">}</span>
<span class="ln">22 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names.yaml'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">23 </span>   <span class="name">yaml</span><span class="operator">.</span><span class="name">dump</span><span class="punctuation">(</span><span class="name">names</span><span class="punctuation">,</span> <span class="name">fh</span><span class="punctuation">)</span></code></pre>
<p>Focusing on the new instructions:</p>
<ul class="simple">
<li><p><strong>line 3:</strong> load the <span class="docutils literal">yaml</span> module</p></li>
<li><p><strong>line 23:</strong> the <span class="docutils literal">yaml.dump()</span> takes 2 arguments: the data structure
(usually as a <span class="docutils literal">dict</span>) and a file-handler</p></li>
</ul>
<p>The program produces the <span class="docutils literal">&quot;names.yaml&quot;</span> file with the following content
(re-formatted for readability):</p>
<pre class="code yaml literal-block" id="names-yaml"><code><span class="literal scalar plain">adults</span><span class="punctuation indicator">:</span> <span class="punctuation indicator">{</span><span class="name variable">Betty</span><span class="punctuation indicator">:</span> <span class="name variable">The Flintstones</span><span class="punctuation indicator">,</span> <span class="name variable">Fred</span><span class="punctuation indicator">:</span> <span class="name variable">The Flintstones</span><span class="punctuation indicator">,</span> <span class="name variable">Homer</span><span class="punctuation indicator">:</span> <span class="name variable">The Simpsons</span><span class="punctuation indicator">,</span> <span class="name variable">Lois</span><span class="punctuation indicator">:</span> <span class="name variable">Family Guy</span><span class="punctuation indicator">}</span>
<span class="literal scalar plain">kids</span><span class="punctuation indicator">:</span> <span class="punctuation indicator">{</span><span class="name variable">Bart</span><span class="punctuation indicator">:</span> <span class="name variable">The Simpsons</span><span class="punctuation indicator">,</span> <span class="name variable">Chris</span><span class="punctuation indicator">:</span> <span class="name variable">Family Guy</span><span class="punctuation indicator">,</span> <span class="name variable">Pebbles</span><span class="punctuation indicator">:</span> <span class="name variable">The Flintstones</span><span class="punctuation indicator">}</span>
<span class="literal scalar plain">other</span><span class="punctuation indicator">:</span> <span class="punctuation indicator">{</span><span class="name variable">Brian</span><span class="punctuation indicator">:</span> <span class="name variable">Family Guy</span><span class="punctuation indicator">,</span> <span class="name variable">Klaus</span><span class="punctuation indicator">:</span> <span class="name variable">American Dad</span><span class="punctuation indicator">,</span> <span class="name variable">Roger</span><span class="punctuation indicator">:</span> <span class="name variable">American Dad</span><span class="punctuation indicator">}</span></code></pre>
</div>
<div class="section" id="more-advanced-yaml-use-case">
<h2><a class="toc-backref" href="#id48"><span class="sectnum">5.3.</span> More advanced YAML use-case</a></h2>
<p>The <em>YAML</em> specifications (see <a class="citation-reference" href="#yaml-specs" id="id17">[YAML_specs]</a>) contain various simple, yet informative examples
about the more advanced capabilities of the format.</p>
<pre class="code yaml literal-block" id="invoice-yaml"><code><span class="name namespace">---</span>
<span class="literal scalar plain">invoice</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">34843</span>
<span class="literal scalar plain">date</span>   <span class="punctuation indicator">:</span> <span class="literal scalar plain">2001-01-23</span>
<span class="literal scalar plain">bill-to</span><span class="punctuation indicator">:</span> <span class="name label">&amp;id001</span>
    <span class="literal scalar plain">given</span>  <span class="punctuation indicator">:</span> <span class="literal scalar plain">Chris</span>
    <span class="literal scalar plain">family</span> <span class="punctuation indicator">:</span> <span class="literal scalar plain">Dumars</span>
    <span class="literal scalar plain">address</span><span class="punctuation indicator">:</span>
        <span class="literal scalar plain">lines</span><span class="punctuation indicator">:</span> <span class="punctuation indicator">|</span>
            <span class="name constant">458 Walkman Dr.</span>
            <span class="name constant">Suite #292</span>
        <span class="literal scalar plain">city</span>    <span class="punctuation indicator">:</span> <span class="literal scalar plain">Royal Oak</span>
        <span class="literal scalar plain">state</span>   <span class="punctuation indicator">:</span> <span class="literal scalar plain">MI</span>
        <span class="literal scalar plain">postal</span>  <span class="punctuation indicator">:</span> <span class="literal scalar plain">48046</span>
<span class="literal scalar plain">ship-to</span><span class="punctuation indicator">:</span> <span class="name variable">*id001</span>
<span class="literal scalar plain">product</span><span class="punctuation indicator">:</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">sku</span>         <span class="punctuation indicator">:</span> <span class="literal scalar plain">BL394D</span>
      <span class="literal scalar plain">quantity</span>    <span class="punctuation indicator">:</span> <span class="literal scalar plain">4</span>
      <span class="literal scalar plain">description</span> <span class="punctuation indicator">:</span> <span class="literal scalar plain">Basketball</span>
      <span class="literal scalar plain">price</span>       <span class="punctuation indicator">:</span> <span class="literal scalar plain">450.00</span>
    <span class="punctuation indicator">-</span> <span class="literal scalar plain">sku</span>         <span class="punctuation indicator">:</span> <span class="literal scalar plain">BL4438H</span>
      <span class="literal scalar plain">quantity</span>    <span class="punctuation indicator">:</span> <span class="literal scalar plain">1</span>
      <span class="literal scalar plain">description</span> <span class="punctuation indicator">:</span> <span class="literal scalar plain">Super Hoop</span>
      <span class="literal scalar plain">price</span>       <span class="punctuation indicator">:</span> <span class="literal scalar plain">2392.00</span>
<span class="literal scalar plain">tax</span>  <span class="punctuation indicator">:</span> <span class="literal scalar plain">251.42</span>
<span class="literal scalar plain">total</span><span class="punctuation indicator">:</span> <span class="literal scalar plain">4443.52</span>
<span class="literal scalar plain">comments</span><span class="punctuation indicator">:</span>
    <span class="literal scalar plain">Late afternoon is best.</span>
    <span class="literal scalar plain">Backup contact is Nancy</span>
    <span class="literal scalar plain">Billsmer &#64; 338-4338.</span></code></pre>
</div>
<div class="section" id="reading-data-from-a-yaml-files">
<h2><a class="toc-backref" href="#id49"><span class="sectnum">5.4.</span> Reading data from a YAML files</a></h2>
<p>Let's create our usual program to read the current format, but with a few
additional features:</p>
<ol class="arabic simple">
<li><p>Instead of hard-coding the data file's name in the program, require the
data file's  name as an CLI argument</p></li>
<li><p>Using the <span class="docutils literal">pprint</span> (pretty-print) module display the data in a more
readable format</p></li>
<li><p>Try to handle errors</p></li>
</ol>
<pre class="code python literal-block" id="read-yaml-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env pythone</span>
<span class="ln"> 2 </span>
<span class="ln"> 3 </span><span class="keyword namespace">import</span> <span class="name namespace">sys</span>
<span class="ln"> 4 </span><span class="keyword namespace">import</span> <span class="name namespace">yaml</span>
<span class="ln"> 5 </span><span class="keyword namespace">import</span> <span class="name namespace">pprint</span> <span class="keyword namespace">as</span> <span class="name namespace">pp</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span><span class="keyword">try</span><span class="punctuation">:</span>
<span class="ln"> 8 </span>   <span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="name">sys</span><span class="operator">.</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">])</span>
<span class="ln"> 9 </span>   <span class="name">data</span> <span class="operator">=</span> <span class="name">yaml</span><span class="operator">.</span><span class="name">load</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">)</span>
<span class="ln">10 </span><span class="keyword">except</span> <span class="name exception">IndexError</span><span class="punctuation">:</span>
<span class="ln">11 </span>   <span class="keyword">print</span><span class="punctuation">(</span><span class="literal string single">'I need an argument: YAML file name'</span><span class="punctuation">)</span>
<span class="ln">12 </span>   <span class="name">sys</span><span class="operator">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="punctuation">)</span>
<span class="ln">13 </span><span class="keyword">except</span> <span class="name">FileNotFoundError</span><span class="punctuation">:</span>
<span class="ln">14 </span>   <span class="keyword">print</span><span class="punctuation">(</span><span class="literal string single">'File &quot;{}&quot; is not found!'</span><span class="operator">.</span><span class="name">format</span><span class="punctuation">(</span><span class="name">sys</span><span class="operator">.</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]))</span>
<span class="ln">15 </span>   <span class="name">sys</span><span class="operator">.</span><span class="name">exit</span><span class="punctuation">(</span><span class="literal number integer">2</span><span class="punctuation">)</span>
<span class="ln">16 </span><span class="keyword">except</span> <span class="name">yaml</span><span class="operator">.</span><span class="name">parser</span><span class="operator">.</span><span class="name">ParserError</span><span class="punctuation">:</span>
<span class="ln">17 </span>   <span class="name">msg</span> <span class="operator">=</span> <span class="literal string single">'The file {} does not appear to be a valid YAML file!'</span>
<span class="ln">18 </span>   <span class="keyword">print</span><span class="punctuation">(</span><span class="name">msg</span><span class="operator">.</span><span class="name">format</span><span class="punctuation">(</span><span class="name">sys</span><span class="operator">.</span><span class="name">argv</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]))</span>
<span class="ln">19 </span><span class="name">pp</span><span class="operator">.</span><span class="name">pprint</span><span class="punctuation">(</span><span class="name">data</span><span class="punctuation">)</span></code></pre>
</div>
</div>
<div class="section" id="working-with-xml-files">
<h1><a class="toc-backref" href="#id50"><span class="sectnum">6.</span> Working with XML files</a></h1>
<p>The eXtensible Markup Language (XML) format is has been the workhorse of data
exchange in the last two decades. Because of its flexibility and the rich
ecosystem XML is still an often used format, especially in enterprise
applications. The format is best suited for the representation of tree-like
data structures. XML also provides standards and tools for the verification of
the data based on schema.</p>
<p>Following is a first simple example of our cartoon characters data in as XML:</p>
<pre class="code xml literal-block" id="names-fred-orig-xml"><span id="examplexml"></span><code><span class="name tag">&lt;character</span> <span class="name attribute">id=</span><span class="literal string">&quot;1000&quot;</span><span class="name attribute">fname=</span><span class="literal string">&quot;Fred&quot;</span> <span class="name attribute">sname=</span><span class="literal string">&quot;Flintstone&quot;</span><span class="name tag">&gt;</span>
  <span class="name tag">&lt;appeared_in&gt;</span>The Flintstones<span class="name tag">&lt;/appeared_in&gt;</span>
  <span class="name tag">&lt;relations&gt;</span>
    <span class="name tag">&lt;relation</span> <span class="name attribute">character_id=</span><span class="literal string">&quot;1001&quot;</span> <span class="name attribute">type=</span><span class="literal string">&quot;child&quot;</span><span class="name tag">&gt;</span>
    <span class="name tag">&lt;relation</span> <span class="name attribute">character_id=</span><span class="literal string">&quot;1002&quot;</span> <span class="name attribute">type=</span><span class="literal string">&quot;spouse&quot;</span><span class="name tag">&gt;</span>
  <span class="name tag">&lt;/relations&gt;</span>
<span class="name tag">&lt;/character&gt;</span></code></pre>
<div class="section" id="xml-support-in-python">
<h2><a class="toc-backref" href="#id51"><span class="sectnum">6.1.</span> XML support in Python</a></h2>
<p>Python has rich XML support in the form of multiple XML related modules and
projects. The two main reason for the lack of a single implementation are on
the one hand the huge scope and functionality of XML, and different
implementations with overlapping functionality.
Out of the many a few of these XML implementations also have made it to the
&quot;Python Standard Library&quot;. (see for more <a class="citation-reference" href="#pydoc-markup-tools" id="id18">[pydoc_markup_tools]</a>)</p>
<p>In our example we'll be using the <span class="docutils literal">lxml</span> module, which is currently
a popular choice.  (see for more <a class="citation-reference" href="#lxml" id="id19">[lxml]</a>) This module is a wrapper around the
<span class="docutils literal">libxml2</span> and <span class="docutils literal">libxslt</span> libraries, both written in C. (see also:
<a class="reference external" href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>)</p>
<p>Execute the following to install the <span class="docutils literal">lxml</span> module:</p>
<pre class="code shell literal-block"><code>pip install lxml</code></pre>
<p><strong>NOTE:</strong> The installation of <span class="docutils literal">lxml</span> require a working C compiler, which may
be an issue, especially for Windows users. Please visit the &quot;Installing
<span class="docutils literal">lxml</span>&quot; page (<a class="citation-reference" href="#lxml-install" id="id20">[lxml_install]</a>) which provides a link to the &quot;unofficial
Windows binaries&quot;.</p>
</div>
<div class="section" id="writing-xml-data">
<h2><a class="toc-backref" href="#id52"><span class="sectnum">6.2.</span> Writing XML data</a></h2>
<p>Working with XML is significantly more complex than the previously discussed
formats. To get acquainted with the API let's follow the &quot;<span class="docutils literal">lxml</span> Tutorial&quot; (see
<a class="citation-reference" href="#lxml-tutorial" id="id21">[lxml_tutorial]</a>) and try to code the <a class="reference external" href="#examplexml">above</a> example manually
in an interactive Python session:</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="keyword namespace"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword namespace">from</span> <span class="name namespace">lxml</span> <span class="keyword namespace">import</span> <span class="name">etree</span>
<span class="ln">2 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'character'</span><span class="punctuation">,</span> <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'id'</span><span class="punctuation">:</span> <span class="literal string single">'1000'</span><span class="punctuation">,</span> <span class="literal string single">'fname'</span><span class="punctuation">:</span> <span class="literal string single">'Fred'</span><span class="punctuation">,</span> <span class="literal string single">'sname'</span><span class="punctuation">:</span> <span class="literal string single">'Flintstone'</span><span class="punctuation">})</span></code></pre>
<p>At this point the <span class="docutils literal">root</span> variable is bound to an object, which represents an
XML node. Let's see how the data is organized:</p>
<pre class="code pycon literal-block"><code><span class="ln">3 </span><span class="name builtin"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name builtin">type</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">)</span>                      <span class="comment single"># the object's type</span>
<span class="ln">4 </span><span class="generic output">&lt;type 'lxml.etree._Element'&gt;
</span><span class="ln">5 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="operator">.</span><span class="name">tag</span>                        <span class="comment single"># the XML tag of this node</span>
<span class="ln">6 </span><span class="generic output">'character'
</span><span class="ln">7 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="operator">.</span><span class="name">attrib</span>                     <span class="comment single"># the XML attributes of the node</span>
<span class="ln">8 </span><span class="generic output">{'fname': 'Fred', 'id': '1000', 'sname': 'Flintstone'}</span></code></pre>
<p>The string representation of this node:</p>
<pre class="code pycon literal-block"><code><span class="ln"> 9 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">)</span>
<span class="ln">10 </span><span class="generic output">b'&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;/&gt;'</span></code></pre>
<p><strong>WARNING:</strong> Notice the <span class="docutils literal">b</span> prefix in the result of the <span class="docutils literal">tostring()</span>
function: the returned object is of type <span class="docutils literal">bytes</span> (and not <span class="docutils literal">str</span>)! If we
were to attempt to write this to a file which has been opened in text mode
(e.g.: &quot;<span class="docutils literal">open( 'somename.xml', 'wt')</span>&quot;), we would get an Exception!</p>
<p>The simple rule here is: <span class="docutils literal">bytes</span> objects can be written to binary files
(i.e.: mode &quot;<span class="docutils literal">wb</span>&quot;) and <span class="docutils literal">str</span> objects to text files (i.e.: mode &quot;<span class="docutils literal">wt</span>&quot;)</p>
<p>For a <span class="docutils literal">str</span> result we need to decode the <span class="docutils literal">tostring()</span> function's result:</p>
<pre class="code pycon literal-block"><code><span class="ln">11 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">()</span>
<span class="ln">12 </span><span class="generic output">'&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;/&gt;'</span></code></pre>
<p>Next, we add two child nodes representing the <span class="docutils literal">appeared_in</span> and the
<span class="docutils literal">relations</span> tags and check the XML output:</p>
<pre class="code pycon literal-block"><code><span class="ln">13 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">a</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'appeared_in'</span><span class="punctuation">)</span> <span class="comment single"># create a new node</span>
<span class="ln">14 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">b</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relations'</span><span class="punctuation">)</span>   <span class="comment single"># another new node</span>
<span class="ln">15 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">a</span><span class="punctuation">)</span>                   <span class="comment single"># add the ``a`` node to root</span>
<span class="ln">16 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">b</span><span class="punctuation">)</span>                   <span class="comment single"># add the ``b`` node to root</span>
<span class="ln">17 </span><span class="generic output">
</span><span class="ln">18 </span><span class="generic output"></span><span class="comment single"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="comment single">### Check the XML representation of ``root``</span>
<span class="ln">19 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span>
<span class="ln">20 </span><span class="generic output">&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;&gt;
</span><span class="ln">21 </span><span class="generic output">  &lt;appeared_in/&gt;
</span><span class="ln">22 </span><span class="generic output">  &lt;relations/&gt;
</span><span class="ln">23 </span><span class="generic output">&lt;/character&gt;
</span><span class="ln">24 </span><span class="generic output">
</span><span class="ln">25 </span><span class="generic output">&gt;&gt;&gt;</span></code></pre>
<p>The <span class="docutils literal">root</span> element is an container object, which currently holds 2 objects.
The API makes it possible to treat <span class="docutils literal">root</span> as if it was a <span class="docutils literal">list</span>.</p>
<pre class="code pycon literal-block"><code><span class="ln">26 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">tag</span>                     <span class="comment single"># element lookup with similar to ``list``</span>
<span class="ln">27 </span><span class="generic output">'appeared_in'
</span><span class="ln">28 </span><span class="generic output"></span><span class="name builtin"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name builtin">len</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">)</span>                       <span class="comment single"># the ``len()`` works correctly</span>
<span class="ln">29 </span><span class="generic output">2
</span><span class="ln">30 </span><span class="generic output">
</span><span class="ln">31 </span><span class="generic output">### with ``for`` we can iterate through the elements
</span><span class="ln">32 </span><span class="generic output"></span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">node</span> <span class="operator word">in</span> <span class="name">root</span><span class="punctuation">:</span>
<span class="ln">33 </span><span class="generic prompt">... </span>    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">node</span><span class="operator">.</span><span class="name">tag</span><span class="punctuation">,</span> <span class="name">node</span><span class="operator">.</span><span class="name">attrib</span><span class="punctuation">)</span>
<span class="ln">34 </span><span class="generic prompt">...</span>
<span class="ln">35 </span><span class="generic output">appeared_in {}
</span><span class="ln">36 </span><span class="generic output">relations {}
</span><span class="ln">37 </span><span class="generic output">&gt;&gt;&gt;</span></code></pre>
<p>Let's add the missing pieces:</p>
<pre class="code pycon literal-block"><code><span class="ln">38 </span><span class="generic output">### Add the cartoon title to the ``appeared_in`` tag
</span><span class="ln">39 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="literal string single">'The Flintstones'</span>
<span class="ln">40 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span>
<span class="ln">41 </span><span class="generic output">### Show changes in XML representation
</span><span class="ln">42 </span><span class="generic output">&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;&gt;
</span><span class="ln">43 </span><span class="generic output">  &lt;appeared_in&gt;The Flintstones&lt;/appeared_in&gt;
</span><span class="ln">44 </span><span class="generic output">  &lt;relations/&gt;
</span><span class="ln">45 </span><span class="generic output">&lt;/character&gt;
</span><span class="ln">46 </span><span class="generic output">
</span><span class="ln">47 </span><span class="generic output">### Add first relation
</span><span class="ln">48 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">r1</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relation'</span><span class="punctuation">,</span> <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'character_id'</span><span class="punctuation">:</span> <span class="literal string single">'1002'</span><span class="punctuation">,</span> <span class="literal string single">'type'</span><span class="punctuation">:</span> <span class="literal string single">'spouse'</span><span class="punctuation">})</span>
<span class="ln">49 </span><span class="generic output">### index 1 is the earlier ``relations`` node. Add ``r1`` node to this
</span><span class="ln">50 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">r1</span><span class="punctuation">)</span>
<span class="ln">51 </span><span class="generic output">### Show XML representation
</span><span class="ln">52 </span><span class="generic output"></span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span>
<span class="ln">53 </span><span class="generic output">&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;&gt;
</span><span class="ln">54 </span><span class="generic output">  &lt;appeared_in&gt;The Flintstones&lt;/appeared_in&gt;
</span><span class="ln">55 </span><span class="generic output">  &lt;relations&gt;
</span><span class="ln">56 </span><span class="generic output">    &lt;relation character_id=&quot;1002&quot; type=&quot;spouse&quot;/&gt;
</span><span class="ln">57 </span><span class="generic output">  &lt;/relations&gt;
</span><span class="ln">58 </span><span class="generic output">&lt;/character&gt;
</span><span class="ln">59 </span><span class="generic output">
</span><span class="ln">60 </span><span class="generic output">### Add second relation
</span><span class="ln">61 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">r2</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relation'</span><span class="punctuation">,</span> <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'character_id'</span><span class="punctuation">:</span> <span class="literal string single">'1001'</span><span class="punctuation">,</span> <span class="literal string single">'type'</span><span class="punctuation">:</span> <span class="literal string single">'child'</span><span class="punctuation">})</span>
<span class="ln">62 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">r2</span><span class="punctuation">)</span>
<span class="ln">63 </span><span class="generic output">### Show XML representation
</span><span class="ln">64 </span><span class="generic output"></span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">print</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span>
<span class="ln">65 </span><span class="generic output">&lt;character fname=&quot;Fred&quot; id=&quot;1000&quot; sname=&quot;Flintstone&quot;&gt;
</span><span class="ln">66 </span><span class="generic output">  &lt;appeared_in&gt;The Flintstones&lt;/appeared_in&gt;
</span><span class="ln">67 </span><span class="generic output">  &lt;relations&gt;
</span><span class="ln">68 </span><span class="generic output">    &lt;relation character_id=&quot;1002&quot; type=&quot;spouse&quot;/&gt;
</span><span class="ln">69 </span><span class="generic output">    &lt;relation character_id=&quot;1001&quot; type=&quot;child&quot;/&gt;
</span><span class="ln">70 </span><span class="generic output">  &lt;/relations&gt;
</span><span class="ln">71 </span><span class="generic output">&lt;/character&gt;</span></code></pre>
<p>At this point we can export the data in XML format:</p>
<pre class="code pycon literal-block"><code><span class="ln">72 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names-fred-written.xml'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span>
<span class="ln">73 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span>
<span class="ln">74 </span><span class="generic output">198
</span><span class="ln">75 </span><span class="generic output"></span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span><span class="operator">.</span><span class="name">close</span><span class="punctuation">()</span></code></pre>
<p>The content of the <span class="docutils literal"><span class="pre">names-fred-written.xml</span></span> file looks like this:</p>
<pre class="code xml literal-block"><code><span class="name tag">&lt;character</span> <span class="name attribute">fname=</span><span class="literal string">&quot;Fred&quot;</span> <span class="name attribute">id=</span><span class="literal string">&quot;1000&quot;</span> <span class="name attribute">sname=</span><span class="literal string">&quot;Flintstone&quot;</span><span class="name tag">&gt;</span>
  <span class="name tag">&lt;appeared_in&gt;</span>The Flintstones<span class="name tag">&lt;/appeared_in&gt;</span>
  <span class="name tag">&lt;relations&gt;</span>
    <span class="name tag">&lt;relation</span> <span class="name attribute">character_id=</span><span class="literal string">&quot;1002&quot;</span> <span class="name attribute">type=</span><span class="literal string">&quot;spouse&quot;</span><span class="name tag">/&gt;</span>
    <span class="name tag">&lt;relation</span> <span class="name attribute">character_id=</span><span class="literal string">&quot;1001&quot;</span> <span class="name attribute">type=</span><span class="literal string">&quot;child&quot;</span><span class="name tag">/&gt;</span>
  <span class="name tag">&lt;/relations&gt;</span>
<span class="name tag">&lt;/character&gt;</span></code></pre>
<p>To summarize the above interactive session, let's put the essential bits into
a single Python program:</p>
<pre class="code python literal-block" id="write-names-as-xml-fred-py"><code><span class="ln"> 1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln"> 2 </span><span class="keyword namespace">from</span> <span class="name namespace">lxml</span> <span class="keyword namespace">import</span> <span class="name">etree</span>
<span class="ln"> 3 </span><span class="name">root</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'character'</span><span class="punctuation">,</span>
<span class="ln"> 4 </span>                     <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'id'</span><span class="punctuation">:</span> <span class="literal string single">'1000'</span><span class="punctuation">,</span>
<span class="ln"> 5 </span>                             <span class="literal string single">'fname'</span><span class="punctuation">:</span> <span class="literal string single">'Fred'</span><span class="punctuation">,</span>
<span class="ln"> 6 </span>                             <span class="literal string single">'sname'</span><span class="punctuation">:</span> <span class="literal string single">'Flintstone'</span><span class="punctuation">})</span>
<span class="ln"> 7 </span><span class="name">a</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'appeared_in'</span><span class="punctuation">)</span> <span class="comment single"># create a new node</span>
<span class="ln"> 8 </span><span class="name">b</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relations'</span><span class="punctuation">)</span>   <span class="comment single"># another new node</span>
<span class="ln"> 9 </span><span class="name">root</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">a</span><span class="punctuation">)</span>                   <span class="comment single"># add the ``a`` node to root</span>
<span class="ln">10 </span><span class="name">root</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">b</span><span class="punctuation">)</span>                   <span class="comment single"># add the ``b`` node to root</span>
<span class="ln">11 </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">0</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="literal string single">'The Flintstones'</span> <span class="comment single"># add title in node ``appeared_in``</span>
<span class="ln">12 </span><span class="name">r1</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relation'</span><span class="punctuation">,</span> <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'character_id'</span><span class="punctuation">:</span> <span class="literal string single">'1002'</span><span class="punctuation">,</span>
<span class="ln">13 </span>                                       <span class="literal string single">'type'</span><span class="punctuation">:</span> <span class="literal string single">'spouse'</span><span class="punctuation">})</span>
<span class="ln">14 </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">r1</span><span class="punctuation">)</span>
<span class="ln">15 </span><span class="name">r2</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">Element</span><span class="punctuation">(</span><span class="literal string single">'relation'</span><span class="punctuation">,</span> <span class="name">attrib</span><span class="operator">=</span><span class="punctuation">{</span><span class="literal string single">'character_id'</span><span class="punctuation">:</span> <span class="literal string single">'1001'</span><span class="punctuation">,</span>
<span class="ln">16 </span>                                       <span class="literal string single">'type'</span><span class="punctuation">:</span> <span class="literal string single">'child'</span><span class="punctuation">})</span>
<span class="ln">17 </span><span class="name">root</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">r2</span><span class="punctuation">)</span>
<span class="ln">18 </span>
<span class="ln">19 </span><span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names-fred-written.xml'</span><span class="punctuation">,</span> <span class="literal string single">'wt'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">20 </span>    <span class="name">fh</span><span class="operator">.</span><span class="name">write</span><span class="punctuation">(</span><span class="name">etree</span><span class="operator">.</span><span class="name">tostring</span><span class="punctuation">(</span><span class="name">root</span><span class="punctuation">,</span> <span class="name">pretty_print</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">decode</span><span class="punctuation">())</span></code></pre>
</div>
<div class="section" id="reading-data-from-an-xml-file">
<h2><a class="toc-backref" href="#id53"><span class="sectnum">6.3.</span> Reading data from an XML file</a></h2>
<p>Using our previous example, let's try re-create the <span class="docutils literal">root</span> object from the
XML file:</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names-fred-written.xml'</span><span class="punctuation">)</span>
<span class="ln">2 </span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">fromstring</span><span class="punctuation">(</span><span class="name">fh</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">())</span></code></pre>
<ul class="simple">
<li><p><strong>line 1:</strong> open the XML file in <span class="docutils literal"><span class="pre">read-only</span></span> and <span class="docutils literal">text</span> mode, because of
implied <span class="docutils literal">&quot;wt&quot;</span> mode string</p></li>
<li><p><strong>line 2:</strong> the step in the order as they are executed:</p>
<ul>
<li><p><span class="docutils literal">fh.read()</span> method will read the entire content of the file into
a <span class="docutils literal">str</span></p></li>
<li><p><span class="docutils literal">etree.fromstring()</span> function will convert this string to an instance of
<span class="docutils literal">lxml.etree._Element</span>, i.e.: the Python object representing the XML
content</p></li>
</ul>
</li>
</ul>
<p>At this point the object bound to the <span class="docutils literal">root</span> variable contains all
information from the file. Using a <span class="docutils literal">for</span> loop we can iterate through the
elements:</p>
<pre class="code pycon literal-block"><code><span class="ln">3 </span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">node</span> <span class="operator word">in</span> <span class="name">root</span><span class="punctuation">:</span>
<span class="ln">4 </span><span class="generic prompt">... </span>    <span class="name">tmpl</span><span class="operator">.</span><span class="name">format</span><span class="punctuation">(</span><span class="name">node</span><span class="operator">.</span><span class="name">tag</span><span class="punctuation">,</span> <span class="name builtin">len</span><span class="punctuation">(</span><span class="name">node</span><span class="punctuation">),</span> <span class="name">node</span><span class="operator">.</span><span class="name">text</span><span class="punctuation">,</span> <span class="name">node</span><span class="operator">.</span><span class="name">attrib</span><span class="punctuation">)</span>
<span class="ln">5 </span><span class="generic prompt">...</span>
<span class="ln">6 </span><span class="generic output">'appeared_in          0     The Flintstones      {}'
</span><span class="ln">7 </span><span class="generic output">'relations            2     \n                    {}'</span></code></pre>
<p>To summarize:</p>
<pre class="code python literal-block" id="read-names-from-xml-py"><code><span class="ln">1 </span><span class="comment hashbang">#!/usr/bin/env python3</span>
<span class="ln">2 </span><span class="keyword namespace">from</span> <span class="name namespace">lxml</span> <span class="keyword namespace">import</span> <span class="name">etree</span>
<span class="ln">3 </span>
<span class="ln">4 </span><span class="name">fh</span> <span class="operator">=</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'names-fred-written.xml'</span><span class="punctuation">)</span>
<span class="ln">5 </span><span class="name">root</span> <span class="operator">=</span> <span class="name">etree</span><span class="operator">.</span><span class="name">fromstring</span><span class="punctuation">(</span><span class="name">fh</span><span class="operator">.</span><span class="name">read</span><span class="punctuation">())</span>
<span class="ln">6 </span><span class="keyword">for</span> <span class="name">node</span> <span class="operator word">in</span> <span class="name">root</span><span class="punctuation">:</span>
<span class="ln">7 </span>    <span class="name">tmpl</span><span class="operator">.</span><span class="name">format</span><span class="punctuation">(</span><span class="name">node</span><span class="operator">.</span><span class="name">tag</span><span class="punctuation">,</span> <span class="name builtin">len</span><span class="punctuation">(</span><span class="name">node</span><span class="punctuation">),</span> <span class="name">node</span><span class="operator">.</span><span class="name">text</span><span class="punctuation">,</span> <span class="name">node</span><span class="operator">.</span><span class="name">attrib</span><span class="punctuation">)</span></code></pre>
<p>For large XML files this approach may be less efficient, since all the
processing is done in the Python interpreter. A more efficient way would be to
outsource the bulk of the work the underlying <span class="docutils literal">libxml2</span> and <span class="docutils literal">libxstl</span>
libraries (see <a class="reference external" href="http://www.xmlsoft.org/">http://www.xmlsoft.org/</a>), which we will consider next.</p>
</div>
<div class="section" id="processing-xml-data-in-python">
<h2><a class="toc-backref" href="#id54"><span class="sectnum">6.4.</span> Processing XML data in Python</a></h2>
<p>Because the data that can be stored in XML format, can be large in terms of
both complexity and amount, processing is usually a non-trivial task. The
<span class="docutils literal">lxml</span> FAQ (see <a class="citation-reference" href="#lxml-faq" id="id22">[lxml_faq]</a>) lists several considerations when processing
XML data. Dealing with large XML files can be more efficient using the
<a class="citation-reference" href="#xpath" id="id23">[xpath]</a> technology, especially if we are only interested in certain parts.</p>
<p>Using an XPath search string return all nodes with the <span class="docutils literal">relation</span> tag. The
parsing and searching is done in the C library, instead of Python, so it's the
performance is optimal:</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="name"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="name">root</span><span class="operator">.</span><span class="name">findall</span><span class="punctuation">(</span><span class="literal string double">&quot;.//relation&quot;</span><span class="punctuation">)</span>
<span class="ln">2 </span><span class="generic output">[&lt;Element relation at 0x7f923f495888&gt;, &lt;Element relation at 0x7f923f46b7c8&gt;]</span></code></pre>
<p>As above, except loop through all the <span class="docutils literal">relation</span> node(s) and show their
attributes.</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">e</span> <span class="operator word">in</span> <span class="name">root</span><span class="operator">.</span><span class="name">findall</span><span class="punctuation">(</span><span class="literal string double">&quot;.//relation&quot;</span><span class="punctuation">):</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">e</span><span class="operator">.</span><span class="name">attrib</span><span class="punctuation">)</span>
<span class="ln">2 </span><span class="generic prompt">...</span>
<span class="ln">3 </span><span class="generic output">{'character_id': '1002', 'type': 'spouse'}
</span><span class="ln">4 </span><span class="generic output">{'character_id': '1001', 'type': 'child'}</span></code></pre>
<p>The following XPath search string will limit the results to <span class="docutils literal">relation</span> nodes
which have a <span class="docutils literal">type</span> attribute with the value <span class="docutils literal">spouse</span>.</p>
<pre class="code pycon literal-block"><code><span class="ln">1 </span><span class="keyword"></span><span class="generic prompt">&gt;&gt;&gt; </span><span class="keyword">for</span> <span class="name">e</span> <span class="operator word">in</span> <span class="name">root</span><span class="operator">.</span><span class="name">findall</span><span class="punctuation">(</span><span class="literal string single">'.//relation[&#64;type=&quot;spouse&quot;]'</span><span class="punctuation">):</span>
<span class="ln">2 </span><span class="generic prompt">... </span>    <span class="keyword">print</span><span class="punctuation">(</span><span class="name">e</span><span class="operator">.</span><span class="name">attrib</span><span class="punctuation">)</span>
<span class="ln">3 </span><span class="generic prompt">...</span>
<span class="ln">4 </span><span class="generic output">{'character_id': '1002', 'type': 'spouse'}
</span><span class="ln">5 </span><span class="generic output">&gt;&gt;&gt;</span></code></pre>
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id55"><span class="sectnum">7.</span> References</a></h1>
<dl class="citation">
<dt class="label" id="pydoc-open"><span class="brackets"><a class="fn-backref" href="#id1">pydoc_open</a></span></dt>
<dd><p>Documentation of the <span class="docutils literal">open()</span> function
<a class="reference external" href="https://docs.python.org/3/library/functions.html#open">https://docs.python.org/3/library/functions.html#open</a></p>
</dd>
<dt class="label" id="ascii1967"><span class="brackets"><a class="fn-backref" href="#id2">ASCII1967</a></span></dt>
<dd><p>ASCII codes represent text in computers, telecommunications
equipment, and other devices. Most modern character-encoding schemes are based
on ASCII, although they support many additional characters.
See: <a class="reference external" href="https://en.wikipedia.org/wiki/ASCII">https://en.wikipedia.org/wiki/ASCII</a></p>
</dd>
<dt class="label" id="unicode2001"><span class="brackets">Unicode2001</span><span class="fn-backref">(<a href="#id3">1</a>,<a href="#id4">2</a>)</span></dt>
<dd><p>Unicode is a computing industry standard for the consistent
encoding, representation, and handling of text expressed in most of the
world's writing systems.
<a class="reference external" href="https://en.wikipedia.org/wiki/Unicode">https://en.wikipedia.org/wiki/Unicode</a></p>
</dd>
<dt class="label" id="csvformat"><span class="brackets"><a class="fn-backref" href="#id5">CSVformat</a></span></dt>
<dd><p>A CSV file stores tabular data (numbers and text) in plain
text. Each line of the file is a data record. Each record consists of one
or more fields, separated by commas (',') or other delimiter characters,
such as semicolon (';'), colon (':'), bar ('|'), etc...
<a class="reference external" href="https://en.wikipedia.org/wiki/Comma-separated_values">https://en.wikipedia.org/wiki/Comma-separated_values</a></p>
</dd>
<dt class="label" id="pydoc-csv"><span class="brackets"><a class="fn-backref" href="#id6">pydoc_csv</a></span></dt>
<dd><p>Python Standard Library documentation, CSV module
<a class="reference external" href="https://docs.python.org/3/library/csv.html">https://docs.python.org/3/library/csv.html</a></p>
</dd>
<dt class="label" id="pydoc-csv-formatting"><span class="brackets"><a class="fn-backref" href="#id7">pydoc_csv_formatting</a></span></dt>
<dd><p><span class="docutils literal">csv</span> module's Dialects and Formatting Parameters
<a class="reference external" href="https://docs.python.org/3/library/csv.html#csv-fmt-params">https://docs.python.org/3/library/csv.html#csv-fmt-params</a></p>
</dd>
<dt class="label" id="pep343"><span class="brackets">pep343</span><span class="fn-backref">(<a href="#id8">1</a>,<a href="#id11">2</a>)</span></dt>
<dd><p>PEP 343 -- The &quot;with&quot; Statement
<a class="reference external" href="https://www.python.org/dev/peps/pep-0343/">https://www.python.org/dev/peps/pep-0343/</a></p>
</dd>
<dt class="label" id="ini-format"><span class="brackets"><a class="fn-backref" href="#id9">INI_format</a></span></dt>
<dd><p>The INI file format is an informal standard for configuration
files capable of representing tree-structure like information.
See: <a class="reference external" href="https://en.wikipedia.org/wiki/INI_file">https://en.wikipedia.org/wiki/INI_file</a></p>
</dd>
<dt class="label" id="pydoc-configparser"><span class="brackets"><a class="fn-backref" href="#id10">pydoc_configparser</a></span></dt>
<dd><p>The <span class="docutils literal">configparser</span> module implements the INI
configuration file format.
See <a class="reference external" href="https://docs.python.org/3/library/configparser.html">https://docs.python.org/3/library/configparser.html</a></p>
</dd>
<dt class="label" id="pep274"><span class="brackets"><a class="fn-backref" href="#id12">pep274</a></span></dt>
<dd><p>Dictionary Comprehensions
<a class="reference external" href="https://www.python.org/dev/peps/pep-0274/">https://www.python.org/dev/peps/pep-0274/</a></p>
</dd>
<dt class="label" id="json"><span class="brackets"><a class="fn-backref" href="#id13">JSON</a></span></dt>
<dd><p>JSON is a language-independent data format. It was derived from
JavaScript, but many modern programming languages include code to generate
and parse JSON-format data.
<a class="reference external" href="https://en.wikipedia.org/wiki/JSON">https://en.wikipedia.org/wiki/JSON</a></p>
</dd>
<dt class="label" id="yaml"><span class="brackets"><a class="fn-backref" href="#id14">YAML</a></span></dt>
<dd><p>YAML is a human-readable data-serialization language. It is commonly
used for configuration files, but could be used in many applications where
data is being stored or transmitted
<a class="reference external" href="https://en.wikipedia.org/wiki/YAML">https://en.wikipedia.org/wiki/YAML</a></p>
</dd>
<dt class="label" id="ansible"><span class="brackets"><a class="fn-backref" href="#id15">Ansible</a></span></dt>
<dd><p>Ansible is an open-source software provisioning, configuration
management, and application-deployment tool.
<a class="reference external" href="https://en.wikipedia.org/wiki/Ansible_(software">https://en.wikipedia.org/wiki/Ansible_(software</a>)</p>
</dd>
<dt class="label" id="pyyaml"><span class="brackets"><a class="fn-backref" href="#id16">PyYAML</a></span></dt>
<dd><p>PyYAML is a full-featured YAML framework for the Python
programming language.
<a class="reference external" href="https://pyyaml.org/">https://pyyaml.org/</a></p>
</dd>
<dt class="label" id="yaml-specs"><span class="brackets"><a class="fn-backref" href="#id17">YAML_specs</a></span></dt>
<dd><p>Full length examples of YAML
<a class="reference external" href="https://yaml.org/spec/1.2/spec.html#id2761803">https://yaml.org/spec/1.2/spec.html#id2761803</a></p>
</dd>
<dt class="label" id="lxml-install"><span class="brackets"><a class="fn-backref" href="#id20">lxml_install</a></span></dt>
<dd><p><a class="reference external" href="https://lxml.de/installation.html">https://lxml.de/installation.html</a></p>
</dd>
<dt class="label" id="lxml-tutorial"><span class="brackets"><a class="fn-backref" href="#id21">lxml_tutorial</a></span></dt>
<dd><p>A brief overview of lxml's concepts
<a class="reference external" href="https://lxml.de/tutorial.html">https://lxml.de/tutorial.html</a></p>
</dd>
<dt class="label" id="pydoc-markup-tools"><span class="brackets"><a class="fn-backref" href="#id18">pydoc_markup_tools</a></span></dt>
<dd><p>The Python Standard Library's Structured Markup
Processing Tools
<a class="reference external" href="https://docs.python.org/3/library/markup.html">https://docs.python.org/3/library/markup.html</a></p>
</dd>
<dt class="label" id="lxml"><span class="brackets"><a class="fn-backref" href="#id19">lxml</a></span></dt>
<dd><p>The <span class="docutils literal">lxml</span> XML toolkit is a Pythonic binding for the C libraries
libxml2 and libxslt.  It provides a the feature completeness of the
C libraries with a mostly compatible API to the well-known ElementTree API
from the Python Standard Library.</p>
</dd>
<dt class="label" id="lxml-faq"><span class="brackets"><a class="fn-backref" href="#id22">lxml_faq</a></span></dt>
<dd><p>The lxml Frequently Asked Questions
<a class="reference external" href="https://lxml.de/FAQ.html">https://lxml.de/FAQ.html</a></p>
</dd>
<dt class="label" id="xpath"><span class="brackets"><a class="fn-backref" href="#id23">xpath</a></span></dt>
<dd><p>The XPath language provides the ability to navigate around in XML
documents, selecting nodes by a variety of criteria.</p>
<p>For more see:</p>
<ul class="simple">
<li><p>XPath in Wikipedia: <a class="reference external" href="https://en.wikipedia.org/wiki/XPath">https://en.wikipedia.org/wiki/XPath</a></p></li>
<li><p>XML and XPath tutorials over at w3school:</p>
<ul>
<li><p><a class="reference external" href="https://www.w3schools.com/xml/xml_xpath.asp">https://www.w3schools.com/xml/xml_xpath.asp</a></p></li>
<li><p><a class="reference external" href="https://www.w3schools.com/xml/xpath_intro.asp">https://www.w3schools.com/xml/xpath_intro.asp</a></p></li>
</ul>
</li>
</ul>
</dd>
</dl>
<!-- vim: filetype=rst textwidth=78 foldmethod=syntax foldcolumn=3 wrap -->
<!-- vim: linebreak ruler spell spelllang=en showbreak=… shiftwidth=3 tabstop=3 -->
</div>
</div>
</body>
</html>
