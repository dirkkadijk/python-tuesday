<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta charset="utf-8"/>
<meta name="generator" content="Docutils 0.14: http://docutils.sourceforge.net/" />
<title>Working with Data Part 1: Spreadsheets</title>
<meta name="author" content="Gábor Nyers" />
<style type="text/css">

/*
 * CSS
 */

html{
  background: #ffffff;
}

@media (max-width: 400px) {
  html {
    /* background: #ffcccc;  */
    font-size: 10px;
  }
}
@media (min-width: 401px) and (max-width: 800px) {
  html {
    /* background: #ccffcc; */
    font-size: 14px;
  }
}
@media (min-width: 801px) {
  html {
    /* background: #ccccff; */
    font-size: 20px;
    max-width: 1024px;
    margin: auto;
  }
}

.content {
  background: #c3c3c3;
}

h1, h2, h3 {
  border-bottom: 1pt #00ff00;
}

h1 {
  font-size: 1.4rem;
}

.topic-title {
  font-size: 1.4rem;
}


p {
  margin: 0.5em;
}

img {
  max-width: 100%;
}

a {
  border: none;
}

dl {
  padding: 0.2em;
}
dt {
  float: left;
  clear: left;
  max-width: 200px;
  text-align: right;
  font-weight: bold;
  background: #f0f0f0;
  color: #222222;
  padding: 0 5px 0 5px;
}
dt::after {
  content: ": ";
}
dd {
  margin: 0 0 0 120px;
  padding: 0 0 0.5em 0;
  padding: 0 5px 0 5px;
}

dd p {
  margin: 0 0 0 0;
}

.caption {
  font-style: italic;
}

/* BEGIN */
pre, .literal {
  margin: 0.5em;
  background: #f0f0f0;
  font: 0.92rem Inconsolata, monospace;
  color: #222222;
  text-shadow: 0 0 5px #C8C8C8;
  white-space: pre-wrap;
  word-wrap: break-word;
}
::selection {
  background: #0080FF;
  text-shadow: none;
}
.ln, .prompt {
  -webkit-user-select: none;  /* Chrome all / Safari all */
  -moz-user-select: none;     /* Firefox all */
  -ms-user-select: none;      /* IE 10+ */
}
/*  END */


/*
vim: filetype=css textwidth=78 foldmethod=syntax foldcolumn=3 wrap
vim: linebreak ruler spell spelllang=en showbreak=… shiftwidth=2
vim: softtabstop=2 tabstop=2
*/


</style>
</head>
<body>
<div class="document" id="working-with-data-part-1-spreadsheets">
<h1 class="title">Working with Data Part 1: Spreadsheets</h1>

<p class="subtitle" id="python-tuesday-session-3">Python Tuesday: Session 3</p>
<dl class="docinfo simple">
<dt class="date">Date</dt>
<dd class="date">2019-09-24</dd>
<dt class="author">Author</dt>
<dd class="author"><p>Gábor Nyers</p></dd>
<dt class="tags">tags</dt>
<dd class="tags"><p>python</p>
</dd>
<dt class="category">category</dt>
<dd class="category"><p>python_workshop</p>
</dd>
<dt class="summary">summary</dt>
<dd class="summary"><p>Reading and writing data to spreadsheets</p>
</dd>
<dt class="licence">licence</dt>
<dd class="licence"><p>CC BY-NC 4.0 <a class="reference external" href="https://creativecommons.org/licenses/by-nc/4.0/">https://creativecommons.org/licenses/by-nc/4.0/</a></p>
</dd>
</dl>
<div class="contents local topic" id="table-of-contents">
<p class="topic-title first">Table of contents</p>
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#introduction-working-with-data-part-1-spreadsheets" id="id5"><span class="sectnum">1.</span> Introduction: Working with data Part 1: Spreadsheets</a></p></li>
<li><p><a class="reference internal" href="#preparations" id="id6"><span class="sectnum">2.</span> Preparations</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#earlier-sessions" id="id7"><span class="sectnum">2.1.</span> Earlier sessions</a></p></li>
<li><p><a class="reference internal" href="#this-session-s-material" id="id8"><span class="sectnum">2.2.</span> This session's material</a></p></li>
<li><p><a class="reference internal" href="#requirements" id="id9"><span class="sectnum">2.3.</span> Requirements</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#working-with-spreadsheets" id="id10"><span class="sectnum">3.</span> Working with Spreadsheets</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#python-modules-to-deal-with-spreadsheets" id="id11"><span class="sectnum">3.1.</span> Python modules to deal with spreadsheets</a></p></li>
<li><p><a class="reference internal" href="#writing-data-to-a-spreadsheet" id="id12"><span class="sectnum">3.2.</span> Writing data to a spreadsheet</a></p></li>
<li><p><a class="reference internal" href="#reading-data-from-a-spreadsheet" id="id13"><span class="sectnum">3.3.</span> Reading data from a spreadsheet</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#showcase-application-time-sheet" id="id14"><span class="sectnum">4.</span> Showcase Application: Time sheet</a></p>
<ul class="auto-toc">
<li><p><a class="reference internal" href="#id4" id="id15"><span class="sectnum">4.1.</span> Requirements</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#references" id="id16"><span class="sectnum">5.</span> References</a></p></li>
</ul>
</div>
<div class="section" id="introduction-working-with-data-part-1-spreadsheets">
<h1><a class="toc-backref" href="#id5"><span class="sectnum">1.</span> Introduction: Working with data Part 1: Spreadsheets</a></h1>
<p>Spreadsheets and databases permeate our business lives. Databases usually
contain structured data and often we use use dedicated applications to
interact with them. Spreadsheets are used to do ad-hoc processing or simply to
compensate for missing features of aforementioned applications.</p>
<p>This is Part 1 of a (potentially) series of sessions where we will focus on
how Python can be useful when dealing with spreadsheets. Our goal is to
live-code a simple Python application to read from- and write data to
spreadsheets.</p>
</div>
<div class="section" id="preparations">
<h1><a class="toc-backref" href="#id6"><span class="sectnum">2.</span> Preparations</a></h1>
<div class="section" id="earlier-sessions">
<h2><a class="toc-backref" href="#id7"><span class="sectnum">2.1.</span> Earlier sessions</a></h2>
<p>As we will build upon the previous topics, you might want to review the
earlier sessions:</p>
<ul class="simple">
<li><p>session 1: Getting your environment set up and ready for Python development
<a class="reference external" href="https://github.com/gnyers/python-tuesday/tree/master/session1">https://github.com/gnyers/python-tuesday/tree/master/session1</a></p></li>
<li><p>session 2: Working with text files and file formats
<a class="reference external" href="https://github.com/gnyers/python-tuesday/tree/master/session2">https://github.com/gnyers/python-tuesday/tree/master/session2</a></p></li>
</ul>
</div>
<div class="section" id="this-session-s-material">
<h2><a class="toc-backref" href="#id8"><span class="sectnum">2.2.</span> This session's material</a></h2>
<p>Visit this page: <a class="reference external" href="https://github.com/gnyers/python-tuesday/tree/master/session3">https://github.com/gnyers/python-tuesday/tree/master/session3</a></p>
<p>OR</p>
<p>Check out the Git repo:</p>
<pre class="code shell literal-block"><code><span class="name builtin">cd</span> <span class="name variable">$PROJECTDIR</span>
git clone git&#64;github.com:gnyers/python-tuesday.git</code></pre>
<p>To follow along with the instructions please open the README.html in your
browser:</p>
<pre class="code shell literal-block"><code>firefox <span class="name variable">$PROJECTDIR</span>/python-tuesday/session3/README.html</code></pre>
</div>
<div class="section" id="requirements">
<h2><a class="toc-backref" href="#id9"><span class="sectnum">2.3.</span> Requirements</a></h2>
<p>The code of this workshop has been tested with:</p>
<ul>
<li><p>Python v3.6 and</p></li>
<li><p>the following modules that are not part of the Python Standard Library:
<span class="docutils literal">openpyxl</span></p>
<p>To install these modules execute:</p>
<pre class="code shell literal-block"><code>pip install --user -r requirements.txt</code></pre>
</li>
</ul>
</div>
</div>
<div class="section" id="working-with-spreadsheets">
<h1><a class="toc-backref" href="#id10"><span class="sectnum">3.</span> Working with Spreadsheets</a></h1>
<div class="contents local topic" id="chapter-contents">
<p class="topic-title first">Chapter contents</p>
<ul class="auto-toc simple">
<li><p><a class="reference internal" href="#python-modules-to-deal-with-spreadsheets" id="id17"><span class="sectnum">3.1.</span> Python modules to deal with spreadsheets</a></p></li>
<li><p><a class="reference internal" href="#writing-data-to-a-spreadsheet" id="id18"><span class="sectnum">3.2.</span> Writing data to a spreadsheet</a></p>
<ul>
<li><p><a class="reference internal" href="#create-a-workbook" id="id19">Create a workbook</a></p></li>
<li><p><a class="reference internal" href="#add-some-data" id="id20">Add some data</a></p></li>
<li><p><a class="reference internal" href="#load-data-from-a-csv-file" id="id21">Load data from a CSV file</a></p></li>
<li><p><a class="reference internal" href="#add-some-formatting" id="id22">Add some formatting</a></p></li>
<li><p><a class="reference internal" href="#add-comment" id="id23">Add comment</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#reading-data-from-a-spreadsheet" id="id24"><span class="sectnum">3.3.</span> Reading data from a spreadsheet</a></p>
<ul>
<li><p><a class="reference internal" href="#getting-some-totals" id="id25">Getting some totals</a></p></li>
<li><p><a class="reference internal" href="#some-simple-analytics" id="id26">Some Simple Analytics</a></p></li>
</ul>
</li>
</ul>
</div>
<p>This chapter will discuss the basics of working with Excel <span class="docutils literal">.xlsx</span> files.</p>
<div class="section" id="python-modules-to-deal-with-spreadsheets">
<h2><a class="toc-backref" href="#id17"><span class="sectnum">3.1.</span> Python modules to deal with spreadsheets</a></h2>
<p>Python provides numerous modules to deal with both Excel and LibreCalc
spreadsheets. Because LibreOffice support Python as macro language, users have
much more advanced capabilities. (See for more: <a class="citation-reference" href="#libreoffice-automation" id="id1">[libreoffice_automation]</a>)</p>
<p>Therefore, in this workshop our focus is on dealing with Excel spreadsheets.
For this we have different options as wel: (Source: <a class="citation-reference" href="#pythonexcel" id="id2">[PythonExcel]</a>)</p>
<ul class="simple">
<li><p>openpyxl: The recommended package for reading and writing Excel 2010 files
(ie: .xlsx)</p></li>
<li><p>xlsxwriter:  An alternative package for writing data, formatting information
and, in particular, charts in the Excel 2010 format (ie: .xlsx)</p></li>
<li><p>xlrd: This package is for reading data and formatting information from older
Excel files (ie: .xls)</p></li>
<li><p>xlwt: This package is for writing data and formatting information to older
Excel files (ie: .xls)</p></li>
</ul>
</div>
<div class="section" id="writing-data-to-a-spreadsheet">
<h2><a class="toc-backref" href="#id18"><span class="sectnum">3.2.</span> Writing data to a spreadsheet</a></h2>
<div class="section" id="create-a-workbook">
<h3><a class="toc-backref" href="#id19">Create a workbook</a></h3>
<p>Following the openpyxl Tutorial (<a class="citation-reference" href="#openpyxl-tutorial" id="id3">[openpyxl_tutorial]</a>) let's create
a spreadsheet in Excel 2010 format:</p>
<pre class="code python literal-block"><code><span class="ln">1 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">import</span> <span class="name namespace">openpyxl</span>
<span class="ln">2 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span> <span class="operator">=</span> <span class="name">openpyxl</span><span class="operator">.</span><span class="name">Workbook</span><span class="punctuation">()</span>           <span class="comment single"># create a new workbook</span>
<span class="ln">3 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws1</span> <span class="operator">=</span> <span class="name">wb</span><span class="operator">.</span><span class="name">active</span>                    <span class="comment single"># get the active sheet</span>
<span class="ln">4 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws1</span><span class="operator">.</span><span class="name">title</span> <span class="operator">=</span> <span class="literal string double">&quot;MySheet&quot;</span>              <span class="comment single"># rename the current sheet</span></code></pre>
<p>Create a new worksheet:</p>
<pre class="code python literal-block"><code><span class="ln">5 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws2</span> <span class="operator">=</span> <span class="name">wb</span><span class="operator">.</span><span class="name">create_sheet</span><span class="punctuation">(</span><span class="literal string single">'TimeReg'</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">)</span>          <span class="comment single"># create a new sheet</span>
<span class="ln">6 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws2</span><span class="operator">.</span><span class="name">sheet_properties</span><span class="operator">.</span><span class="name">tabColor</span> <span class="operator">=</span> <span class="literal string double">&quot;aa00bb&quot;</span>     <span class="comment single"># change tab color</span>
<span class="ln">7 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws1</span><span class="operator">.</span><span class="name">sheet_properties</span><span class="operator">.</span><span class="name">tabColor</span> <span class="operator">=</span> <span class="literal string double">&quot;00bbaa&quot;</span>     <span class="comment single"># change the other sheet's color</span>
<span class="ln">8 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="literal string single">'sandbox/test00.xlsx'</span><span class="punctuation">)</span>               <span class="comment single"># save the workbook to file</span></code></pre>
<!-- Resize a window with `xdotool`:
 sleep 2 && xdotool getactivewindow windowsize $(xdotool getwindowfocus) 720 400

Screenshot with `xfce-screenshot`:
 sleep 2 && xfce4-screenshooter - -window - -save test-xlsx-01.png -->
<p>The sheet now should look something like this:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/test00.xlsx"><img alt="A simple workbook created by openpyxl" src="images/test00-xlsx-01.png" /></a>
<p class="caption">The spreadsheet created by the <span class="docutils literal">openpyxl</span> module. Note the color of the
worksheets.</p>
</div>
</div>
<div class="section" id="add-some-data">
<h3><a class="toc-backref" href="#id20">Add some data</a></h3>
<p>Now let's put some data into the sheet &quot;TimeReg&quot;:</p>
<pre class="code python literal-block"><code><span class="ln"> 9 </span><span class="comment single">### Get a sheet by its name</span>
<span class="ln">10 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws_tr</span> <span class="operator">=</span> <span class="name">wb</span><span class="punctuation">[</span><span class="literal string single">'TimeReg'</span><span class="punctuation">]</span>
<span class="ln">11 </span>
<span class="ln">12 </span><span class="comment single">### Fill the first row with some data</span>
<span class="ln">13 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">11</span><span class="punctuation">):</span>
<span class="ln">14 </span><span class="operator">...</span>     <span class="name">ws_tr</span><span class="operator">.</span><span class="name">cell</span><span class="punctuation">(</span><span class="name">row</span><span class="operator">=</span><span class="literal number integer">1</span><span class="punctuation">,</span> <span class="name">column</span><span class="operator">=</span><span class="name">i</span><span class="punctuation">,</span> <span class="name">value</span><span class="operator">=</span><span class="literal string single">'Col{}'</span><span class="operator">.</span><span class="name">format</span><span class="punctuation">(</span><span class="name">i</span><span class="punctuation">))</span>
<span class="ln">15 </span><span class="operator">...</span>
<span class="ln">16 </span><span class="operator">...</span>                                    <span class="comment single"># doctest: +ELLIPSIS</span>
<span class="ln">17 </span><span class="operator">&lt;</span><span class="name">Cell</span> <span class="literal string single">'TimeReg'</span><span class="operator">.</span><span class="name">A1</span><span class="operator">&gt;</span>
<span class="ln">18 </span><span class="operator">&lt;</span><span class="name">Cell</span> <span class="literal string single">'TimeReg'</span><span class="operator">.</span><span class="name">B1</span><span class="operator">&gt;</span>
<span class="ln">19 </span><span class="operator">&lt;</span><span class="name">Cell</span> <span class="literal string single">'TimeReg'</span><span class="operator">.</span><span class="name">C1</span><span class="operator">&gt;</span>
<span class="ln">20 </span><span class="operator">...</span>
<span class="ln">21 </span>
<span class="ln">22 </span><span class="comment single">### Save the workbook to file</span>
<span class="ln">23 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="literal string single">'sandbox/test01.xlsx'</span><span class="punctuation">)</span></code></pre>
<p>The sheet now should look something like this:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/test01.xlsx"><img alt="Workbook with some data" src="images/test01-xlsx-01.png" /></a>
<p class="caption">The &quot;TimeReg&quot; sheet now has some data.</p>
</div>
</div>
<div class="section" id="load-data-from-a-csv-file">
<h3><a class="toc-backref" href="#id21">Load data from a CSV file</a></h3>
<p>Let's load the data from the <span class="docutils literal">names.csv</span> file into our sheet. The content of
the file is as follows:</p>
<pre class="code ini literal-block"><code><span class="ln">1 </span><span class="name attribute">name|full_name|group|gendergroup|agegroup</span>
<span class="ln">2 </span><span class="name attribute">fred|Fred Flintstone|flintstones|m|adults</span>
<span class="ln">3 </span><span class="name attribute">wilma|Wilma Flintstone|flintstones|f|adults</span>
<span class="ln">4 </span><span class="name attribute">pebbles|Pebbles Flintstone|flintstones|f|kids</span></code></pre>
<p>The code:</p>
<pre class="code python literal-block"><code><span class="ln">20 </span><span class="comment single">### We'll read from a csv file</span>
<span class="ln">21 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">import</span> <span class="name namespace">csv</span>
<span class="ln">22 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">with</span> <span class="name builtin">open</span><span class="punctuation">(</span><span class="literal string single">'../session2/names.csv'</span><span class="punctuation">)</span> <span class="keyword">as</span> <span class="name">fh</span><span class="punctuation">:</span>
<span class="ln">23 </span><span class="operator">...</span>     <span class="name">data</span> <span class="operator">=</span> <span class="name builtin">list</span><span class="punctuation">(</span><span class="name">csv</span><span class="operator">.</span><span class="name">reader</span><span class="punctuation">(</span><span class="name">fh</span><span class="punctuation">,</span> <span class="name">delimiter</span><span class="operator">=</span><span class="literal string single">'|'</span><span class="punctuation">))</span>
<span class="ln">24 </span>
<span class="ln">25 </span><span class="comment single">### Add a new sheet 'Names' to load the data into</span>
<span class="ln">26 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws3</span> <span class="operator">=</span> <span class="name">wb</span><span class="operator">.</span><span class="name">create_sheet</span><span class="punctuation">(</span><span class="literal string single">'Names'</span><span class="punctuation">)</span>
<span class="ln">27 </span>
<span class="ln">28 </span><span class="comment single">### Activate the new sheet when the workbook loads</span>
<span class="ln">29 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">active</span> <span class="operator">=</span> <span class="name">ws3</span>
<span class="ln">30 </span>
<span class="ln">31 </span><span class="comment single">### Add data to sheet</span>
<span class="ln">32 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">for</span> <span class="name">row</span> <span class="operator word">in</span> <span class="name">data</span><span class="punctuation">:</span> <span class="name">ws3</span><span class="operator">.</span><span class="name">append</span><span class="punctuation">(</span><span class="name">row</span><span class="punctuation">)</span>
<span class="ln">33 </span><span class="operator">...</span>                                    <span class="comment single"># doctest: +ELLIPSIS</span>
<span class="ln">34 </span>
<span class="ln">35 </span><span class="comment single">### Save the workbook to file</span>
<span class="ln">36 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="literal string single">'sandbox/test02.xlsx'</span><span class="punctuation">)</span></code></pre>
<p>The result:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/test02.xlsx"><img alt="Workbook with some data" src="images/test02-xlsx-01.png" /></a>
<p class="caption">The 'Names' sheet now contains the CSV data. Note: multiple columns appear
as too narrow; this is</p>
</div>
</div>
<div class="section" id="add-some-formatting">
<h3><a class="toc-backref" href="#id22">Add some formatting</a></h3>
<p>Formatting of cells can be done either directly or by applying a style. In
general using styles is preferable.</p>
<pre class="code python literal-block"><code><span class="ln">37 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">from</span> <span class="name namespace">openpyxl.styles</span> <span class="keyword namespace">import</span> <span class="name">NamedStyle</span><span class="punctuation">,</span> <span class="name">Font</span><span class="punctuation">,</span> <span class="name">Border</span>
<span class="ln">38 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">from</span> <span class="name namespace">openpyxl.styles.borders</span> <span class="keyword namespace">import</span> <span class="name">Side</span>
<span class="ln">39 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">h1</span> <span class="operator">=</span> <span class="name">openpyxl</span><span class="operator">.</span><span class="name">styles</span><span class="operator">.</span><span class="name">NamedStyle</span><span class="punctuation">(</span><span class="name">name</span><span class="operator">=</span><span class="literal string single">'h1'</span><span class="punctuation">)</span>
<span class="ln">40 </span>
<span class="ln">41 </span><span class="comment single">### Font style: bold, 18pt &quot;Arial&quot; of a nice color;</span>
<span class="ln">42 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">h1</span><span class="operator">.</span><span class="name">font</span> <span class="operator">=</span> <span class="name">Font</span><span class="punctuation">(</span><span class="literal string single">'Arial'</span><span class="punctuation">,</span> <span class="name">sz</span><span class="operator">=</span><span class="literal number integer">18</span><span class="punctuation">,</span> <span class="name">b</span><span class="operator">=</span><span class="name builtin pseudo">True</span><span class="punctuation">,</span> <span class="name">color</span><span class="operator">=</span><span class="literal string single">'aa00bb'</span><span class="punctuation">)</span>
<span class="ln">43 </span>
<span class="ln">44 </span><span class="comment single">### Border style:</span>
<span class="ln">45 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">b_med</span> <span class="operator">=</span> <span class="name">Side</span><span class="punctuation">(</span><span class="name">color</span><span class="operator">=</span><span class="literal string single">'aa00bb'</span><span class="punctuation">,</span> <span class="name">border_style</span><span class="operator">=</span><span class="literal string single">'medium'</span> <span class="punctuation">)</span>
<span class="ln">46 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">h1</span><span class="operator">.</span><span class="name">border</span> <span class="operator">=</span> <span class="name">Border</span><span class="punctuation">(</span><span class="name">bottom</span><span class="operator">=</span><span class="name">b_med</span><span class="punctuation">)</span>
<span class="ln">47 </span>
<span class="ln">48 </span><span class="comment single">### Apply the style to the 1st row</span>
<span class="ln">49 </span><span class="comment single">### Note: numbering of cells starts with 1!</span>
<span class="ln">50 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">for</span> <span class="name">i</span> <span class="operator word">in</span> <span class="name builtin">range</span><span class="punctuation">(</span><span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">6</span><span class="punctuation">):</span>
<span class="ln">51 </span><span class="operator">...</span>     <span class="name">ws3</span><span class="operator">.</span><span class="name">cell</span><span class="punctuation">(</span><span class="name">row</span><span class="operator">=</span><span class="literal number integer">1</span><span class="punctuation">,</span> <span class="name">column</span><span class="operator">=</span><span class="name">i</span><span class="punctuation">)</span><span class="operator">.</span><span class="name">style</span> <span class="operator">=</span> <span class="name">h1</span>
<span class="ln">52 </span><span class="operator">...</span>                                    <span class="comment single"># doctest: +ELLIPSIS</span>
<span class="ln">53 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="literal string single">'sandbox/test05.xlsx'</span><span class="punctuation">)</span>     <span class="comment single"># save the workbook to file</span></code></pre>
<p>This will result in the following:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/test05.xlsx"><img alt="Custom sytle" src="images/test05-xlsx-01.png" /></a>
<p class="caption">The first row of the &quot;TimeReg&quot; sheet has the custom style &quot;h1&quot;. Note that
graphical design is not a primary concern at this point ;-)</p>
</div>
</div>
<div class="section" id="add-comment">
<h3><a class="toc-backref" href="#id23">Add comment</a></h3>
<p>Comments can contain useful auxiliary information about a cell, such as
instructions to the user or ways to verify the correctness of the data.</p>
<pre class="code python literal-block"><code><span class="ln"> 8 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">from</span> <span class="name namespace">openpyxl.comments</span> <span class="keyword namespace">import</span> <span class="name">Comment</span>
<span class="ln"> 9 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws3</span><span class="punctuation">[</span><span class="literal string single">'A1'</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">comment</span> <span class="operator">=</span> <span class="name">Comment</span><span class="punctuation">(</span><span class="literal string single">'Data imported from ``names.csv``'</span><span class="punctuation">,</span> <span class="literal string single">'John Doe'</span><span class="punctuation">)</span>
<span class="ln">10 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span><span class="operator">.</span><span class="name">save</span><span class="punctuation">(</span><span class="literal string single">'sandbox/test06.xlsx'</span><span class="punctuation">)</span>     <span class="comment single"># save the workbook to file</span></code></pre>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/test06.xlsx"><img alt="Comment added to cell &quot;A1&quot;" src="images/test06-xlsx-01.png" /></a>
<p class="caption">The cell &quot;A1&quot; now contains a comment</p>
</div>
</div>
</div>
<div class="section" id="reading-data-from-a-spreadsheet">
<h2><a class="toc-backref" href="#id24"><span class="sectnum">3.3.</span> Reading data from a spreadsheet</a></h2>
<div class="section" id="getting-some-totals">
<h3><a class="toc-backref" href="#id25">Getting some totals</a></h3>
<p>Our goal is to calculate the total number of billable and non-billable hours
based on the data of the following timesheet:</p>
<div class="figure align-center">
<a class="reference external image-reference" href="sandbox/timesheet.xlsx"><img alt="Comment added to cell &quot;A1&quot;" src="images/timesheet-xlsx-01.png" /></a>
<p class="caption">Example timesheet containing data</p>
</div>
<p>First let's load the data from the spreadsheet:
<em>(Please type the following in an interactive Python session)</em></p>
<pre class="code python literal-block"><code><span class="ln"> 1 </span><span class="comment single">### load the ``openpyxl`` module</span>
<span class="ln"> 2 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword namespace">import</span> <span class="name namespace">openpyxl</span>
<span class="ln"> 3 </span>
<span class="ln"> 4 </span><span class="comment single">### open the workbook</span>
<span class="ln"> 5 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">wb</span> <span class="operator">=</span> <span class="name">openpyxl</span><span class="operator">.</span><span class="name">load_workbook</span><span class="punctuation">(</span><span class="literal string single">'sandbox/timesheet.xlsx'</span><span class="punctuation">)</span>
<span class="ln"> 6 </span>
<span class="ln"> 7 </span><span class="comment single">### select the sheet containing the required data</span>
<span class="ln"> 8 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">ws</span> <span class="operator">=</span> <span class="name">wb</span><span class="punctuation">[</span><span class="literal string single">'TimeSheet'</span><span class="punctuation">]</span>
<span class="ln"> 9 </span>
<span class="ln">10 </span><span class="comment single">### select the cells that contain the data; this obviously implies that you</span>
<span class="ln">11 </span><span class="comment single">### need to be familiar with the structure of the workbook</span>
<span class="ln">12 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">data_range</span> <span class="operator">=</span> <span class="name">ws</span><span class="punctuation">[</span><span class="literal string single">'A5:G40'</span><span class="punctuation">]</span>
<span class="ln">13 </span>
<span class="ln">14 </span><span class="comment single">### let's retrieve the data with the following list comprehension</span>
<span class="ln">15 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">timesheet</span> <span class="operator">=</span> <span class="punctuation">[</span> <span class="punctuation">[</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span>  <span class="keyword">for</span> <span class="name">cell</span> <span class="operator word">in</span> <span class="name">row</span>  <span class="punctuation">]</span>  <span class="keyword">for</span> <span class="name">row</span> <span class="operator word">in</span> <span class="name">data_range</span> <span class="punctuation">]</span>
<span class="ln">16 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">timesheet</span><span class="punctuation">)</span>                              <span class="comment single"># doctest: +ELLIPSIS</span>
<span class="ln">17 </span><span class="punctuation">[[</span><span class="literal string single">'Date'</span><span class="punctuation">,</span> <span class="literal string single">'ProjectID'</span><span class="punctuation">,</span> <span class="literal string single">'ActivityID'</span><span class="punctuation">,</span> <span class="literal string single">'Billable Hours'</span><span class="punctuation">,</span> <span class="literal string single">'Non-Billable Hours'</span><span class="punctuation">,</span> <span class="literal string single">'RemarkPub'</span><span class="punctuation">,</span> <span class="literal string single">'RemarkPriv'</span><span class="punctuation">],</span> <span class="punctuation">[</span><span class="name">datetime</span><span class="operator">.</span><span class="name">datetime</span><span class="punctuation">(</span><span class="literal number integer">2019</span><span class="punctuation">,</span> <span class="literal number integer">9</span><span class="punctuation">,</span> <span class="literal number integer">1</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">,</span> <span class="literal number integer">0</span><span class="punctuation">)</span><span class="operator">...</span></code></pre>
<p>We're now ready to calculate the total number of billable hours from the range
<span class="docutils literal">'D5:D40'</span>:</p>
<pre class="code python literal-block"><code><span class="ln">18 </span><span class="comment single">### select the cells which contain the billable hours</span>
<span class="ln">19 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">range_billable</span> <span class="operator">=</span> <span class="name">ws</span><span class="punctuation">[</span><span class="literal string single">'D5:D40'</span><span class="punctuation">]</span>
<span class="ln">20 </span>
<span class="ln">21 </span><span class="comment single">### since the range is 2D data structure, we'll need a nested loop to</span>
<span class="ln">22 </span><span class="comment single">### process the data</span>
<span class="ln">23 </span><span class="comment single">###</span>
<span class="ln">24 </span><span class="comment single">### with the following list comprehension we create a list of hours</span>
<span class="ln">25 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">billable_hours</span> <span class="operator">=</span> <span class="punctuation">[</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span>  <span class="keyword">for</span> <span class="name">row</span> <span class="operator word">in</span> <span class="name">range_billable</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">:]</span>
<span class="ln">26 </span><span class="operator">...</span>                                <span class="keyword">for</span> <span class="name">cell</span> <span class="operator word">in</span> <span class="name">row</span> <span class="keyword">if</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span> <span class="punctuation">]</span>
<span class="ln">27 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">billable_hours</span><span class="punctuation">)</span>
<span class="ln">28 </span><span class="punctuation">[</span><span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">5</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">,</span> <span class="literal number integer">8</span><span class="punctuation">]</span>
<span class="ln">29 </span>
<span class="ln">30 </span><span class="comment single">### the total of the billable hours</span>
<span class="ln">31 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name builtin">sum</span><span class="punctuation">(</span><span class="name">billable_hours</span><span class="punctuation">))</span>
<span class="ln">32 </span><span class="literal number integer">156</span></code></pre>
<p>In a similar manner, we'll calculate the total of non-billable hours based on
the data in the range <span class="docutils literal">'E5:E40'</span>:</p>
<pre class="code python literal-block"><code><span class="ln">33 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">range_non_billable</span> <span class="operator">=</span> <span class="name">ws</span><span class="punctuation">[</span><span class="literal string single">'E5:E40'</span><span class="punctuation">]</span>
<span class="ln">34 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">non_billable_hours</span> <span class="operator">=</span> <span class="punctuation">[</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span>  <span class="keyword">for</span> <span class="name">row</span> <span class="operator word">in</span> <span class="name">range_non_billable</span><span class="punctuation">[</span><span class="literal number integer">1</span><span class="punctuation">:]</span>
<span class="ln">35 </span><span class="operator">...</span>                                    <span class="keyword">for</span> <span class="name">cell</span> <span class="operator word">in</span> <span class="name">row</span> <span class="keyword">if</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span> <span class="punctuation">]</span>
<span class="ln">36 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">non_billable_hours</span><span class="punctuation">)</span>
<span class="ln">37 </span><span class="punctuation">[</span><span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">3</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">,</span> <span class="literal number integer">2</span><span class="punctuation">]</span>
<span class="ln">38 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">total_non_billable</span> <span class="operator">=</span> <span class="name builtin">sum</span><span class="punctuation">(</span><span class="name">non_billable_hours</span><span class="punctuation">)</span>
<span class="ln">39 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">total_non_billable</span><span class="punctuation">)</span>
<span class="ln">40 </span><span class="literal number integer">54</span></code></pre>
</div>
<div class="section" id="some-simple-analytics">
<h3><a class="toc-backref" href="#id26">Some Simple Analytics</a></h3>
<p>Suppose we're interested in the dates when the number of billable hours was
below 8:</p>
<pre class="code python literal-block"><code><span class="ln">41 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">r</span> <span class="operator">=</span> <span class="name">ws</span><span class="punctuation">[</span><span class="literal string single">'A6:D40'</span><span class="punctuation">]</span>
<span class="ln">42 </span>
<span class="ln">43 </span><span class="comment single">### Let's write up the query in a more understandable form</span>
<span class="ln">44 </span><span class="comment single">### NOTE: the &lt;1&gt;...&lt;5&gt; indicate the order in which Python executes the</span>
<span class="ln">45 </span><span class="comment single">###       statements</span>
<span class="ln">46 </span><span class="operator">&gt;&gt;&gt;</span> <span class="name">result</span> <span class="operator">=</span> <span class="punctuation">[</span>
<span class="ln">47 </span><span class="operator">...</span>  <span class="punctuation">[</span> <span class="name">cell</span><span class="operator">.</span><span class="name">value</span>                   <span class="comment single"># &lt;5&gt; take the current cell's value</span>
<span class="ln">48 </span><span class="operator">...</span>    <span class="keyword">for</span> <span class="name">cell</span> <span class="operator word">in</span> <span class="name">row</span><span class="punctuation">[::</span><span class="literal number integer">3</span><span class="punctuation">]</span>         <span class="comment single"># &lt;4&gt; loop through the current row and</span>
<span class="ln">49 </span><span class="operator">...</span>                                 <span class="comment single">#     take only elements w/ index 0 and 3</span>
<span class="ln">50 </span><span class="operator">...</span>  <span class="punctuation">]</span>
<span class="ln">51 </span><span class="operator">...</span>  <span class="keyword">for</span> <span class="name">row</span> <span class="operator word">in</span> <span class="name">r</span>                   <span class="comment single"># &lt;1&gt; loop through the data</span>
<span class="ln">52 </span><span class="operator">...</span>      <span class="keyword">if</span> <span class="name">row</span><span class="punctuation">[</span><span class="literal number integer">3</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">value</span>            <span class="comment single"># &lt;2&gt; take only rows where the billable</span>
<span class="ln">53 </span><span class="operator">...</span>                                 <span class="comment single">#     hours are non-empty, and</span>
<span class="ln">54 </span><span class="operator">...</span>         <span class="operator word">and</span>
<span class="ln">55 </span><span class="operator">...</span>         <span class="name">row</span><span class="punctuation">[</span><span class="literal number integer">3</span><span class="punctuation">]</span><span class="operator">.</span><span class="name">value</span> <span class="operator">&lt;</span> <span class="literal number integer">8</span>        <span class="comment single"># &lt;3&gt; where the value is less than 8</span>
<span class="ln">56 </span><span class="operator">...</span> <span class="punctuation">]</span>
<span class="ln">57 </span>
<span class="ln">58 </span><span class="comment single">### the ``result`` variable now points to a list of lists (2D list)</span>
<span class="ln">59 </span><span class="comment single">### of the days when the number of billable hours were &lt; 8:</span>
<span class="ln">60 </span><span class="operator">&gt;&gt;&gt;</span> <span class="keyword">for</span> <span class="name">d</span><span class="punctuation">,</span> <span class="name">h</span> <span class="operator word">in</span> <span class="name">result</span><span class="punctuation">:</span> <span class="keyword">print</span><span class="punctuation">(</span><span class="name">d</span><span class="operator">.</span><span class="name">strftime</span><span class="punctuation">(</span><span class="literal string single">'%Y-%m-</span><span class="literal string interpol">%d</span><span class="literal string single">'</span><span class="punctuation">),</span> <span class="name">h</span><span class="punctuation">)</span>
<span class="ln">61 </span><span class="literal number integer">2019</span><span class="operator">-</span><span class="literal number integer">09</span><span class="operator">-</span><span class="literal number oct">03</span> <span class="literal number integer">5</span>
<span class="ln">62 </span><span class="literal number integer">2019</span><span class="operator">-</span><span class="literal number integer">09</span><span class="operator">-</span><span class="literal number integer">10</span> <span class="literal number integer">5</span>
<span class="ln">63 </span><span class="literal number integer">2019</span><span class="operator">-</span><span class="literal number integer">09</span><span class="operator">-</span><span class="literal number integer">17</span> <span class="literal number integer">5</span>
<span class="ln">64 </span><span class="literal number integer">2019</span><span class="operator">-</span><span class="literal number integer">09</span><span class="operator">-</span><span class="literal number integer">24</span> <span class="literal number integer">5</span></code></pre>
</div>
</div>
</div>
<div class="section" id="showcase-application-time-sheet">
<h1><a class="toc-backref" href="#id14"><span class="sectnum">4.</span> Showcase Application: Time sheet</a></h1>
<div class="section" id="id4">
<h2><a class="toc-backref" href="#id15"><span class="sectnum">4.1.</span> Requirements</a></h2>
</div>
</div>
<div class="section" id="references">
<h1><a class="toc-backref" href="#id16"><span class="sectnum">5.</span> References</a></h1>
<dl class="citation">
<dt class="label" id="pythonexcel"><span class="brackets"><a class="fn-backref" href="#id2">PythonExcel</a></span></dt>
<dd><p><a class="reference external" href="http://www.python-excel.org/">http://www.python-excel.org/</a></p>
</dd>
<dt class="label" id="pymod-openpyxl"><span class="brackets">pymod_openpyxl</span></dt>
<dd><p>OpenPyXL is a Python library to read/write Excel 2010
xlsx/xlsm/xltx/xltm files</p>
<ul class="simple">
<li><p>source: <a class="reference external" href="https://bitbucket.org/openpyxl/openpyxl">https://bitbucket.org/openpyxl/openpyxl</a></p></li>
<li><p>documentation: <a class="reference external" href="https://openpyxl.readthedocs.io/">https://openpyxl.readthedocs.io/</a></p></li>
</ul>
</dd>
<dt class="label" id="openpyxl-tutorial"><span class="brackets"><a class="fn-backref" href="#id3">openpyxl_tutorial</a></span></dt>
<dd><p><a class="reference external" href="https://openpyxl.readthedocs.io/en/stable/tutorial.html">https://openpyxl.readthedocs.io/en/stable/tutorial.html</a></p>
</dd>
<dt class="label" id="libreoffice-automation"><span class="brackets"><a class="fn-backref" href="#id1">libreoffice_automation</a></span></dt>
<dd><p>Automate your office tasks with Python Macros
<a class="reference external" href="http://christopher5106.github.io/office/2015/12/06/openoffice-libreoffice-automate-your-office-tasks-with-python-macros.html">http://christopher5106.github.io/office/2015/12/06/openoffice-libreoffice-automate-your-office-tasks-with-python-macros.html</a></p>
</dd>
</dl>
<!-- vim: filetype=rst tw=78 foldmethod=marker foldcolumn=3 wrap lbr nolist -->
<!-- vim: spelllang=en,nl spell showbreak=… ruler -->
</div>
</div>
</body>
</html>
